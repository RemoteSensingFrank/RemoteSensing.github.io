<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>吴蔚</title>
  
  <subtitle>生命不息，折腾不止！</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.wuweiblog.com/"/>
  <updated>2019-12-10T02:30:50.087Z</updated>
  <id>http://www.wuweiblog.com/</id>
  
  <author>
    <name>John Doe Thanks the author of the theme</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ArcGIS绘图功能</title>
    <link href="http://www.wuweiblog.com/2019/12/03/ArcGIS%E7%BB%98%E5%9B%BE%E5%8A%9F%E8%83%BD/"/>
    <id>http://www.wuweiblog.com/2019/12/03/ArcGIS绘图功能/</id>
    <published>2019-12-03T11:32:00.000Z</published>
    <updated>2019-12-10T02:30:50.087Z</updated>
    
    <content type="html"><![CDATA[<h3 id="概述："><a href="#概述：" class="headerlink" title="概述："></a>概述：</h3><p>&nbsp; &nbsp; &nbsp; &nbsp;在GIS应用中有一个十分重要的应用为绘图应用，一直以来基于Web的GIS在绘图方面的应用都是弱项，这其中主要问题在于Web GIS在应用过程中，所有数据都是通过浏览器进行存储和渲染，而浏览器所能够使用到的计算机资源是有限的，因此相比于给予客户端的GIS软件，基于Web GIS的应用中绘制的功能较弱，因此Web GIS更偏向于数据展示，然而随着计算机性能的发展与WebGL技术的发展，Web GIS的应用领域得到了极大的扩展，以前看起来较为复杂的绘制功能实际上也能够在浏览器端得到比较好的实现，下面我将仔细描述一下通过ArcGIS进行WebGIS应用的绘图功能。</p><h3 id="ArcGIS绘图功能说明："><a href="#ArcGIS绘图功能说明：" class="headerlink" title="ArcGIS绘图功能说明："></a>ArcGIS绘图功能说明：</h3><p>&nbsp; &nbsp; &nbsp; &nbsp;基于ArcGIS的绘图功能的实现实际上主要是通过Draw这个对象来实现的，在 <a href="https://developers.arcgis.com/javascript/latest/api-reference/esri-views-draw-Draw.html" target="_blank" rel="noopener">官网</a>上会有比较详细的Demo和说明，但是为了方便理解以及应用，我这里还是进行一些简单的总结：</p><ul><li>1 通过Sketch来实现绘图功能，实际上简单的来说就是指直接通过Sketch Widget这个控件来实现绘图功能；</li><li>2 通过Draw函数实现绘图功能；</li></ul><p>&nbsp; &nbsp; &nbsp; &nbsp;如果想要采用第一种方法进行绘制，则方法很简单，引入对应的控件，然后就能够实现画图功能，包括绘制点，线，面以及一些包括正方形，圆形在内的规则形状，同时还提供了选择、编辑以及删除绘制的图形等功能，通过此控件进行绘制主要优点在于使用简单，能够快速的搭建起一个绘制的功能，但是通过此控件进行绘图也存在着一些问题，主要问题在于无法进行定制化的应用，如果只是需要一个简单而且功能全面的绘图控件，则此控件完全符合要求，如果功能要求有较强的定制化，则此控件可能难以满足要求，另外对于完成的控件的定制化开发可能需要花费更多的时间，如果大家想要了解Sketch控件的使用，直接关注<a href="https://developers.arcgis.com/javascript/latest/sample-code/sketch-geometries/index.html" target="_blank" rel="noopener">ArcGIS的Demo网站</a>查看示例代码就可以了。</p><p>&nbsp; &nbsp; &nbsp; &nbsp;对于大部分应用来说，直接使用空间远远满足不了应用要求，需要提供更加底层的API进行定制化的开发，这样我们就需要使用到Draw模块了。实际上这个模块的使用过程也比较简单，主要包括以下几个步骤：1.引入Draw模块；2.Draw模块与view视图进行绑定；3.定义绘制的方法；4.绘制方法d的响应；下面我们针对以上几个步骤进行分别的说明：</p><p>&nbsp; &nbsp; &nbsp; &nbsp;1.引入绘制函数：“esri/views/draw/Draw”，直接通过require模块引入绘制函数模块，然后直接定义全局绘制函数绑定view以便于进行绘制；2.Draw模块与View进行绑定，定义绘制方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"> // create a new instance of draw</span><br><span class="line">var draw = new Draw(&#123;</span><br><span class="line">  view: view</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// create an instance of draw polyline action</span><br><span class="line">// the polyline vertices will be only added when</span><br><span class="line">// the pointer is clicked on the view</span><br><span class="line">var action = draw.create(&quot;polyline&quot;, &#123;mode: &quot;click&quot;&#125;);</span><br><span class="line"></span><br><span class="line">// fires when a vertex is added</span><br><span class="line">action.on(&quot;vertex-add&quot;, function (evt) &#123;</span><br><span class="line">  measureLine(evt.vertices);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// fires when the pointer moves</span><br><span class="line">action.on(&quot;cursor-update&quot;, function (evt) &#123;</span><br><span class="line">  measureLine(evt.vertices);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// fires when the drawing is completed</span><br><span class="line">action.on(&quot;draw-complete&quot;, function (evt) &#123;</span><br><span class="line">  measureLine(evt.vertices);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// fires when a vertex is removed</span><br><span class="line">action.on(&quot;vertex-remove&quot;, function (evt) &#123;</span><br><span class="line">  measureLine(evt.vertices);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">function measureLine(vertices) &#123;</span><br><span class="line">  view.graphics.removeAll();</span><br><span class="line"></span><br><span class="line">  var line = createLine(vertices);</span><br><span class="line">  var lineLength = geometryEngine.geodesicLength(line, &quot;miles&quot;);</span><br><span class="line">  var graphic = createGraphic(line);</span><br><span class="line">  view.graphics.add(graphic);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>通过action定义绘制方法，在ArcGIS中的绘制方法包括：Point，MutiPoint，Polyline，Polygon，定义绘制方法之后就需要响应绘制函数，实际上对于绘制不同的地物，对应需要响应的方法也存在差异，如果需要将绘制的结果进行保存，一般l来说我们再新建一个GraphicsLayer图层，通过此图层进行保存，将数据保存到图层中。<br>整体代码为：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"utf-8"</span> /&gt;</span><br><span class="line">    &lt;meta</span><br><span class="line">      name=<span class="string">"viewport"</span></span><br><span class="line">      content=<span class="string">"initial-scale=1,maximum-scale=1,user-scalable=no"</span></span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;title&gt;Draw polyline - <span class="number">4.13</span>&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    &lt;link</span></span><br><span class="line"><span class="regexp">      rel="stylesheet"</span></span><br><span class="line"><span class="regexp">      href="https:/</span><span class="regexp">/js.arcgis.com/</span><span class="number">4.13</span>/esri/themes/light/main.css<span class="string">"</span></span><br><span class="line"><span class="string">    /&gt;</span></span><br><span class="line"><span class="string">    &lt;script src="</span>https:<span class="comment">//js.arcgis.com/4.13/"&gt;&lt;/script&gt;</span></span><br><span class="line">    &lt;script src=<span class="string">"http://libs.baidu.com/jquery/2.1.4/jquery.min.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">      html,</span><br><span class="line">      body,</span><br><span class="line">      #viewDiv &#123;</span><br><span class="line">        height: <span class="number">100</span>%;</span><br><span class="line">        width: <span class="number">100</span>%;</span><br><span class="line">        margin: <span class="number">0</span>;</span><br><span class="line">        padding: <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &lt;<span class="regexp">/style&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    &lt;script&gt;</span></span><br><span class="line"><span class="regexp">      require([</span></span><br><span class="line"><span class="regexp">        "esri/Map",</span></span><br><span class="line"><span class="regexp">        "esri/views/MapView",</span></span><br><span class="line"><span class="regexp">        "esri/views/draw/Draw",</span></span><br><span class="line"><span class="regexp">        "esri/Graphic",</span></span><br><span class="line"><span class="regexp">        "esri/layers/GraphicsLayer",</span></span><br><span class="line"><span class="regexp">        "esri/geometry/geometryEngine"</span></span><br><span class="line"><span class="regexp">      ], function(Map, MapView, Draw, Graphic, GraphicsLayer,geometryEngine) &#123;</span></span><br><span class="line"><span class="regexp">        const map = new Map(&#123;</span></span><br><span class="line"><span class="regexp">          basemap: "gray"</span></span><br><span class="line"><span class="regexp">        &#125;);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        const view = new MapView(&#123;</span></span><br><span class="line"><span class="regexp">          container: "viewDiv",</span></span><br><span class="line"><span class="regexp">          map: map,</span></span><br><span class="line"><span class="regexp">          zoom: 16,</span></span><br><span class="line"><span class="regexp">          center: [18.06, 59.34]</span></span><br><span class="line"><span class="regexp">        &#125;);</span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/var layerSave = new GraphicsLayer();</span></span><br><span class="line"><span class="regexp">        var layerSavePoint = new GraphicsLayer();</span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/map.add(layerSave);</span></span><br><span class="line"><span class="regexp">        map.add(layerSavePoint);</span></span><br><span class="line"><span class="regexp">        var param=&#123;</span></span><br><span class="line"><span class="regexp">              "devType":0,</span></span><br><span class="line"><span class="regexp">              "schemeId":"07b0486b0e014b5ba80685d72dc38351"</span></span><br><span class="line"><span class="regexp">            &#125;;</span></span><br><span class="line"><span class="regexp">        $.ajax(&#123;</span></span><br><span class="line"><span class="regexp">              url: "http:/</span><span class="regexp">/192.168.43.214:8087/</span>visual/query-project-scheme-dev<span class="string">",</span></span><br><span class="line"><span class="string">              type: "</span>post<span class="string">",</span></span><br><span class="line"><span class="string">              data: JSON.stringify(param),</span></span><br><span class="line"><span class="string">              headers: &#123;</span></span><br><span class="line"><span class="string">                  'Origin':"</span>*<span class="string">",</span></span><br><span class="line"><span class="string">                  'content-type': "</span>application/json<span class="string">",</span></span><br><span class="line"><span class="string">                  // 'token': "</span>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE1NzQ5MjUzNzAsInVzZXJuYW1lIjoiaHowMDEifQ.P1Rzs0A6klHU6CZqBuItibpya-kfsT5kJ1w7EboJtAo<span class="string">"</span></span><br><span class="line"><span class="string">              &#125;,</span></span><br><span class="line"><span class="string">              success: function(result) &#123;  //这里就是我出错的地方</span></span><br><span class="line"><span class="string">                console.log(result.data.list[0]);</span></span><br><span class="line"><span class="string">                for(var i=0;i&lt;result.data.list.length;++i)&#123;</span></span><br><span class="line"><span class="string">                  var graphic=Graphic.fromJSON(JSON.parse(result.data.list[i]["</span>geometryInfo<span class="string">"]));</span></span><br><span class="line"><span class="string">                  layerSavePoint.graphics.add(graphic);</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">              &#125;,</span></span><br><span class="line"><span class="string">              error: function(data) &#123;</span></span><br><span class="line"><span class="string">                console.log("</span>请求出错<span class="string">");</span></span><br><span class="line"><span class="string">              &#125;</span></span><br><span class="line"><span class="string">        &#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        // add the button for the draw tool</span></span><br><span class="line"><span class="string">        view.ui.add("</span>line-button<span class="string">", "</span>top-left<span class="string">");</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        const draw = new Draw(&#123;</span></span><br><span class="line"><span class="string">          view: view</span></span><br><span class="line"><span class="string">        &#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        var drawType=0;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        // draw polyline button</span></span><br><span class="line"><span class="string">        document.getElementById("</span>line-button<span class="string">").onclick = function() &#123;</span></span><br><span class="line"><span class="string">            const action = draw.create("</span>polyline<span class="string">");</span></span><br><span class="line"><span class="string">            action.on(</span></span><br><span class="line"><span class="string">              [</span></span><br><span class="line"><span class="string">                "</span>vertex-add<span class="string">",</span></span><br><span class="line"><span class="string">                "</span>vertex-remove<span class="string">",</span></span><br><span class="line"><span class="string">                "</span>cursor-update<span class="string">",</span></span><br><span class="line"><span class="string">                "</span>redo<span class="string">",</span></span><br><span class="line"><span class="string">                "</span>undo<span class="string">"</span></span><br><span class="line"><span class="string">              ],</span></span><br><span class="line"><span class="string">              updateVertices</span></span><br><span class="line"><span class="string">            );  </span></span><br><span class="line"><span class="string">            action.on("</span>draw-complete<span class="string">", function (evt) &#123;</span></span><br><span class="line"><span class="string">              saveLineGraphic(evt);</span></span><br><span class="line"><span class="string">            &#125;);</span></span><br><span class="line"><span class="string">        &#125;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        // Checks if the last vertex is making the line intersect itself.</span></span><br><span class="line"><span class="string">        function updateVertices(event) &#123;</span></span><br><span class="line"><span class="string">          // create a polyline from returned vertices</span></span><br><span class="line"><span class="string">          if (event.vertices.length &gt; 1) &#123;</span></span><br><span class="line"><span class="string">            const result = createLineGraphic(event);</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        // create a new graphic presenting the polyline that is being drawn on the view</span></span><br><span class="line"><span class="string">        function createLineGraphic(event) &#123;</span></span><br><span class="line"><span class="string">            const vertices = event.vertices;</span></span><br><span class="line"><span class="string">            view.graphics.removeAll();</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            // a graphic representing the polyline that is being drawn</span></span><br><span class="line"><span class="string">            const graphic = new Graphic(&#123;</span></span><br><span class="line"><span class="string">                geometry: &#123;</span></span><br><span class="line"><span class="string">                type: "</span>polyline<span class="string">",</span></span><br><span class="line"><span class="string">                paths: vertices,</span></span><br><span class="line"><span class="string">                spatialReference: view.spatialReference</span></span><br><span class="line"><span class="string">                &#125;,</span></span><br><span class="line"><span class="string">                symbol: &#123;</span></span><br><span class="line"><span class="string">                type: "</span>simple-line<span class="string">", // autocasts as new SimpleFillSymbol</span></span><br><span class="line"><span class="string">                color: [4, 90, 141],</span></span><br><span class="line"><span class="string">                width: 4,</span></span><br><span class="line"><span class="string">                cap: "</span>round<span class="string">",</span></span><br><span class="line"><span class="string">                join: "</span>round<span class="string">",</span></span><br><span class="line"><span class="string">                style: "</span>dash<span class="string">"</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">            &#125;);</span></span><br><span class="line"><span class="string">            view.graphics.add(graphic);</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        function saveLineGraphic(event)&#123;</span></span><br><span class="line"><span class="string">            const vertices = event.vertices;</span></span><br><span class="line"><span class="string">            view.graphics.removeAll();</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            // a graphic representing the polyline that is being drawn</span></span><br><span class="line"><span class="string">            const graphic = new Graphic(&#123;</span></span><br><span class="line"><span class="string">                geometry: &#123;</span></span><br><span class="line"><span class="string">                type: "</span>polyline<span class="string">",</span></span><br><span class="line"><span class="string">                paths: vertices,</span></span><br><span class="line"><span class="string">                spatialReference: view.spatialReference</span></span><br><span class="line"><span class="string">                &#125;,</span></span><br><span class="line"><span class="string">                symbol: &#123;</span></span><br><span class="line"><span class="string">                type: "</span>simple-line<span class="string">", // autocasts as new SimpleFillSymbol</span></span><br><span class="line"><span class="string">                color: [4, 90, 141],</span></span><br><span class="line"><span class="string">                width: 4,</span></span><br><span class="line"><span class="string">                cap: "</span>round<span class="string">",</span></span><br><span class="line"><span class="string">                join: "</span>round<span class="string">",</span></span><br><span class="line"><span class="string">                style: "</span>dash<span class="string">"</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">            &#125;);</span></span><br><span class="line"><span class="string">            layerSavePoint.graphics.add(graphic);</span></span><br><span class="line"><span class="string">            var param=&#123;</span></span><br><span class="line"><span class="string">              "</span>devType<span class="string">":0,</span></span><br><span class="line"><span class="string">              "</span>geometryInfo<span class="string">":JSON.stringify(graphic.toJSON()),</span></span><br><span class="line"><span class="string">              "</span>schemeId<span class="string">":"</span><span class="number">07</span>b0486b0e014b5ba80685d72dc38351<span class="string">"</span></span><br><span class="line"><span class="string">            &#125;;</span></span><br><span class="line"><span class="string">            $.ajax(&#123;</span></span><br><span class="line"><span class="string">              url: "</span>http:<span class="comment">//192.168.43.214:8087/visual/add-project-scheme-dev",</span></span><br><span class="line">              type: <span class="string">"post"</span>,</span><br><span class="line">              data: <span class="built_in">JSON</span>.stringify(param),</span><br><span class="line">              headers: &#123;</span><br><span class="line">                  <span class="string">'Origin'</span>:<span class="string">"*"</span>,</span><br><span class="line">                  <span class="string">'content-type'</span>: <span class="string">"application/json"</span>,</span><br><span class="line">                  <span class="comment">// 'token': "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE1NzQ5MjUzNzAsInVzZXJuYW1lIjoiaHowMDEifQ.P1Rzs0A6klHU6CZqBuItibpya-kfsT5kJ1w7EboJtAo"</span></span><br><span class="line">              &#125;,</span><br><span class="line">              success: <span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;  <span class="comment">//这里就是我出错的地方</span></span><br><span class="line">                <span class="built_in">console</span>.log(result.msg);</span><br><span class="line">              &#125;,</span><br><span class="line">              error: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"请求出错"</span>);</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">previewPointGraphic</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> coordinates=event.coordinates;</span><br><span class="line">            view.graphics.removeAll();</span><br><span class="line">            <span class="keyword">var</span> point = &#123;</span><br><span class="line">                type: <span class="string">"point"</span>, <span class="comment">// autocasts as /Point</span></span><br><span class="line">                x: coordinates[<span class="number">0</span>],</span><br><span class="line">                y: coordinates[<span class="number">1</span>],</span><br><span class="line">                spatialReference: view.spatialReference</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> graphic = <span class="keyword">new</span> Graphic(&#123;</span><br><span class="line">                geometry: point,</span><br><span class="line">                symbol: &#123;</span><br><span class="line">                type: <span class="string">"picture-marker"</span>, <span class="comment">// autocasts as SimpleMarkerSymbol</span></span><br><span class="line">                url: <span class="string">"https://static.arcgis.com/images/Symbols/Shapes/BlackStarLargeB.png"</span>,</span><br><span class="line">                size: <span class="string">"16px"</span>,</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            view.graphics.add(graphic);            </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">savePointGraphic</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> coordinates=event.coordinates;</span><br><span class="line">            view.graphics.removeAll();</span><br><span class="line">            <span class="keyword">var</span> point = &#123;</span><br><span class="line">                type: <span class="string">"point"</span>, <span class="comment">// autocasts as /Point</span></span><br><span class="line">                x: coordinates[<span class="number">0</span>],</span><br><span class="line">                y: coordinates[<span class="number">1</span>],</span><br><span class="line">                spatialReference: view.spatialReference</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> graphic = <span class="keyword">new</span> Graphic(&#123;</span><br><span class="line">                geometry: point,</span><br><span class="line">                symbol: &#123;</span><br><span class="line">                type: <span class="string">"picture-marker"</span>, <span class="comment">// autocasts as SimpleMarkerSymbol</span></span><br><span class="line">                url: <span class="string">"https://static.arcgis.com/images/Symbols/Shapes/BlackStarLargeB.png"</span>,</span><br><span class="line">                size: <span class="string">"16px"</span>,</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            layerSavePoint.graphics.add(graphic);</span><br><span class="line">            <span class="keyword">var</span> param=&#123;</span><br><span class="line">              <span class="string">"devType"</span>:<span class="number">0</span>,</span><br><span class="line">              <span class="string">"geometryInfo"</span>:<span class="built_in">JSON</span>.stringify(graphic.toJSON()),</span><br><span class="line">              <span class="string">"schemeId"</span>:<span class="string">"07b0486b0e014b5ba80685d72dc38351"</span></span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="comment">//console.log(JSON.stringify(graphic.toJSON()));</span></span><br><span class="line">            $.ajax(&#123;</span><br><span class="line">              url: <span class="string">"http://192.168.43.214:8087/visual/add-project-scheme-dev"</span>,</span><br><span class="line">              type: <span class="string">"post"</span>,</span><br><span class="line">              data: <span class="built_in">JSON</span>.stringify(param),</span><br><span class="line">              headers: &#123;</span><br><span class="line">                  <span class="string">'Origin'</span>:<span class="string">"*"</span>,</span><br><span class="line">                  <span class="string">'content-type'</span>: <span class="string">"application/json"</span>,</span><br><span class="line">                  <span class="comment">// 'token': "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE1NzQ5MjUzNzAsInVzZXJuYW1lIjoiaHowMDEifQ.P1Rzs0A6klHU6CZqBuItibpya-kfsT5kJ1w7EboJtAo"</span></span><br><span class="line">              &#125;,</span><br><span class="line">              success: <span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;  <span class="comment">//这里就是我出错的地方</span></span><br><span class="line">                <span class="built_in">console</span>.log(result.msg);</span><br><span class="line">              &#125;,</span><br><span class="line">              error: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"请求出错"</span>);</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="comment">//console.log(JSON.stringify(graphic.toJSON()));</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>head&gt;</span><br><span class="line"></span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;div id=<span class="string">"viewDiv"</span>&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        id=<span class="string">"line-button"</span></span><br><span class="line">        <span class="class"><span class="keyword">class</span></span>=<span class="string">"esri-widget esri-widget--button esri-interactive"</span></span><br><span class="line">        title=<span class="string">"Draw polyline"</span></span><br><span class="line">      &gt;</span><br><span class="line">        &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"esri-icon-polyline"</span>&gt;&lt;/span&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  &lt;<span class="regexp">/body&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>html&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;概述：&quot;&gt;&lt;a href=&quot;#概述：&quot; class=&quot;headerlink&quot; title=&quot;概述：&quot;&gt;&lt;/a&gt;概述：&lt;/h3&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;在GIS应用中有一个十分重要的应用为绘图应用，一直以来基于Web的GIS在绘图
      
    
    </summary>
    
      <category term="学习" scheme="http://www.wuweiblog.com/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="ArcGIS开发" scheme="http://www.wuweiblog.com/tags/ArcGIS%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>无所谓与焦虑</title>
    <link href="http://www.wuweiblog.com/2019/11/17/%E6%97%A0%E6%89%80%E8%B0%93%E4%B8%8E%E7%84%A6%E8%99%91/"/>
    <id>http://www.wuweiblog.com/2019/11/17/无所谓与焦虑/</id>
    <published>2019-11-17T06:07:00.000Z</published>
    <updated>2019-11-17T10:38:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>&nbsp; &nbsp; &nbsp; &nbsp;最近总是觉得自己很容易就变得焦虑，对此有很多的思考，其实有很多时候，很多焦虑其实不是别人给的，而是自己给自己的，很多时候我都在想，为什么我会要觉得焦虑呢？我们生活的底线是什么，如果只是为了能够生活下去，其实我们完全可以没有太大的必要感到焦虑。但是另一个方面，其实这个社会在贩卖焦虑，在鼓励焦虑，在告诉年轻人你们需要焦虑，你们需要像工蚁一样干活。不管是“中国梦”也好，还是“社会主义伟大复兴”也罢，对于年轻人来说其实都很虚无缥缈，我们只想看见我们眼前的，我们只相信我们手中的，至于为什么这样，我想即使不说大家也明白。</p><p>&nbsp; &nbsp; &nbsp; &nbsp;好像社会中对年轻人（也许九零后不应该算是年轻人了）充斥着两种截然不同的态度，一种是是迎合，另一种是批判。其实我觉得问题并不在于九零后，而是社会与经济的发展，实际上社会发展的常态化在于阶级之间流动性减弱，资本在人生中占据了主要作用，个人的努力在生产资料面前显得不那么重要。当社会面临这几点之后必然会出现我们所面临的困境。社会重要资源集中在上层和下层，因为上层是统治阶级，是决策者，是社会总生产资料的拥有者，所以社会资源像他们集中，而下层人民，他们是国家的主人，他们是被解放的人，他们从一无所有到一无所有，社会资源保障他们的基本诉求是为了让社会不致陷于动荡。然而所谓的中产阶层，实际上是最无力的阶层，他们没有上层人士的资源，有缺乏下层人士失去一切的勇气，由此注定了他们的软弱。所以提中产阶层这个概念我觉得在我国的大环境下最容易困扰与压榨的对象。</p><p>&nbsp; &nbsp; &nbsp; &nbsp;而年轻人，和中产阶级就比较像，一方面望着高昂的房价，年轻人看到了资本的力量，也许一套房就是自己一生无法企及的资本，而这一切可能生来就注定了。所以很多人选择了颓废，选择去他妈的吧，既然资本让年轻人没有未来，那年轻人就干脆选择放弃未来了，我觉得这样也挺好。就让资本收割止于我们这一代就好了吧，所以年轻人就开始丧了，开始彻底的无所谓起来。但是我们的无所谓并不是真的无所谓，当机会在面前的时候还是会感到焦虑，所以处于一种二元对立的分裂当中，所以我们一边无所谓一边焦虑。</p><p>&nbsp; &nbsp; &nbsp; &nbsp;时代的特点注定没有其他人能够体会，所以我们只能默默承受，然后面对着这个时代拔刀吧！</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;最近总是觉得自己很容易就变得焦虑，对此有很多的思考，其实有很多时候，很多焦虑其实不是别人给的，而是自己给自己的，很多时候我都在想，为什么我会要觉得焦虑呢？我们生活的底线是什么，如果只是为了能够生活下去，其实我们完全可以没
      
    
    </summary>
    
      <category term="随感" scheme="http://www.wuweiblog.com/categories/%E9%9A%8F%E6%84%9F/"/>
    
    
      <category term="随感" scheme="http://www.wuweiblog.com/tags/%E9%9A%8F%E6%84%9F/"/>
    
  </entry>
  
  <entry>
    <title>忙碌边缘</title>
    <link href="http://www.wuweiblog.com/2019/11/10/%E5%BF%99%E7%A2%8C%E8%BE%B9%E7%BC%98/"/>
    <id>http://www.wuweiblog.com/2019/11/10/忙碌边缘/</id>
    <published>2019-11-10T11:32:00.000Z</published>
    <updated>2019-11-10T12:54:38.000Z</updated>
    
    <content type="html"><![CDATA[<p>&nbsp; &nbsp; &nbsp; &nbsp;上个周末就在宿舍睡觉，这个周末也在家里平躺着休息。本来想着能够看一下书顺便整理一下自己的知识体系架构，但是好像计划的事情全部都没有做，有一点点感觉到恐慌。但是我又在想，其实我不应该恐慌才是，工作和学习（实际上我认为学习也是工作的一部分）虽然是我们生命中很重要的一部分，但是我们也没有必要因为自己有时候的休息而感到自责和惭愧，可是到底是什么原因让我感觉到因为每周这两天的休息而感到恐慌和惭愧呢？<br>&nbsp; &nbsp; &nbsp; &nbsp;虽然说我支持高考，支持目前的教育模式，但是不得不说，一直处在竞争教育模式下的我们都面临着囚徒困境，为了稀缺的资源不得不与其他人竞争，而这样的竞争导致的最大的后果是资源变得更加稀缺，我们永远不会满足。经常跟梓萌聊起她在国外生活的日子，也许是资本主义国家社会财富确实比较丰富吧，她跟我说国外的人看起来会要安逸很多，每当这个时候我就会跟她说，其实这个是社会发展的结果，等我们社会财富积累与发展之后我们也能够向他们一样安逸。这个说法听起来很有道理也很励志，但是实际上却是有着极大的问题，只要有人的地方就会有着不平等，老板就是能够比员工有着更大的话语权，也许话不是这么好听，但是道理却是很浅显的。很早之前就了解到，虽然我们社会科技与经济的发展在这一两百年内超过了过去甚至几千年发展的总和，但是人性的发展却是极其缓慢的，我们面临着的问题实际上也差不多，或许我们通过互联网能够有更大的视野，更广泛的信息来源途径，但是实际上这个社会的结构本身没有太多的改变。  </p><p>&nbsp; &nbsp; &nbsp; &nbsp;我本身是一个不太喜欢冒险的人，我总是喜欢一切尽在掌握中的感觉，但是实际上我们身处这个社会中就如同大海中的小木筏，任何一个风浪就会让我们掉入深渊，所以我感到害怕。但是换个角度想想，好像我身边就没有发现能够掌握自己命运的人，大家都是这个样子，往前是未知，往后是深渊，所以我害怕，我需要更大的船，更多的救生装备。所以我对时间的流逝感到紧张，感到害怕。但是其实生活并不应该是这个样子，前两天的时候梓萌说她回家八点能够吃到晚饭就感觉是早的了，她说她不想过这样的生活，实话说其实我也不想过这样的生活，但是我们能够过什么样的生活？回老家去拼爹好像也拼不过人家，在这里好歹还能苟活，回去就真的不知道应该怎么生活了。  </p><p>&nbsp; &nbsp; &nbsp; &nbsp;乱七八糟的想法写了很多，也没有什么太有价值的东西，</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;上个周末就在宿舍睡觉，这个周末也在家里平躺着休息。本来想着能够看一下书顺便整理一下自己的知识体系架构，但是好像计划的事情全部都没有做，有一点点感觉到恐慌。但是我又在想，其实我不应该恐慌才是，工作和学习（实际上我认为学习也
      
    
    </summary>
    
      <category term="随感" scheme="http://www.wuweiblog.com/categories/%E9%9A%8F%E6%84%9F/"/>
    
    
      <category term="随感" scheme="http://www.wuweiblog.com/tags/%E9%9A%8F%E6%84%9F/"/>
    
  </entry>
  
  <entry>
    <title>Kafka原理与应用</title>
    <link href="http://www.wuweiblog.com/2019/10/29/kafka%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/"/>
    <id>http://www.wuweiblog.com/2019/10/29/kafka原理与应用/</id>
    <published>2019-10-29T08:34:08.000Z</published>
    <updated>2019-08-22T10:32:30.000Z</updated>
    
    <content type="html"><![CDATA[<p>&nbsp;&nbsp;&nbsp;&nbsp;Kafka是最初由Linkedin公司开发，是一个分布式、支持分区的（partition）、多副本的（replica），基于zookeeper协调的分布式消息系统，它的最大的特性就是可以实时的处理大量数据以满足各种需求场景：比如基于hadoop的批处理系统、低延迟的实时系统、storm/Spark流式处理引擎，web/nginx日志、访问日志，消息服务等等，用scala语言编写，Linkedin于2010年贡献给了Apache基金会并成为顶级开源项目。提高Kafka我们首先从消息队列入手，然后再看看Kafka的架构设计存在的特点以及其应用。</p><h2 id="消息队列"><a href="#消息队列" class="headerlink" title="消息队列"></a>消息队列</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;什么是消息队列，简单的来说消息队列（Message Queue）是一种进程间通信或同一进程的不同线程间的通信方式。消息队列可以理解为前后端的一个中间件，对于一般应用来说，由前端直接访问后端或者后端向前端推送消息，这样的模式存在着几个问题：1.前后端应用耦合性的问题；2.程序异步执行问题；3.流量控制问题；而消息队列的出现就是针对以上几个问题的一个解决方案。<br>&nbsp;&nbsp;&nbsp;&nbsp;以一个简单的例子来说明消息队列的应用场景，比如秒杀系统，在短时间内会存在大量的用户请求，这些请求如果全部都由后台来进行处理，则会导致后台压力大大提高，甚至会出现无法响应的问题，而前端用户需要等待的时间也大大延长，为了能够处理以上问题，我们通过一个消息队列快速存储所有用户消息，由于队列是一个先进先出的存储模式，因此通过消息队列的形式保证用户请求都能够请求到，然后后台逐步进行响应，从前端用户来说降低了请求无法响应的概率，同时后台也能够大大减轻服务压力。但是这样做也会出现一个问题，就是我们将用户请求发给消息队列后，用户接收到处理完成信息，但是这并不代表消息已经被处理了，因此需要重新在后台处理完消息队列后的消息后再提供反馈确认消息处理完成，当然采用消息队列虽然能够解决一些问题，但是滥用消息队列也会造成一些问题，主要包括：</p><ul><li><strong><em>系统可用性降低：</em></strong> 系统可用性在某种程度上降低，为什么这样说呢？在加入MQ之前，你不用考虑消息丢失或者说MQ挂掉等等的情况，但是，引入MQ之后你就需要去考虑了！</li><li><strong><em>系统复杂性提高：</em></strong> 加入MQ之后，你需要保证消息没有被重复消费、处理消息丢失的情况、保证消息传递的顺序性等等问题！</li><li><strong><em>一致性问题：</em></strong> 我上面讲了消息队列可以实现异步，消息队列带来的异步确实可以提高系统响应速度。但是，万一消息的真正消费者并没有正确消费消息怎么办？这样就会导致数据不一致的情况了!</li></ul><p>提出以上问题只是为了说明消息队列能够对系统负载有极大的提高，但是我们也不能忽略其带来的副作用，什么时候使用消息队列，以及如何使用需要我们仔细思考。</p><h2 id="Kafka原理说明"><a href="#Kafka原理说明" class="headerlink" title="Kafka原理说明"></a>Kafka原理说明</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;其实kafka也就是是一种消息队列，只是其在简单的消息队列的基础上进行了更加完整的架构，我们下面仔细说明一下kafka的架构信息。<br><img src="https://blogimage-1251632003.cos.ap-guangzhou.myqcloud.com/kafka%E6%9E%B6%E6%9E%84%E5%9B%BE.png" alt="kafka架构"><br>&nbsp;&nbsp;&nbsp;&nbsp;从上面的架构图中可以看到，kafka的几个特点以及几个名词，主要包括：</p><ul><li>生产者（Producer）:消息和数据生产者</li><li>代理（Broker）:缓存代理，Kafka的核心功能</li><li>消费者（Consumer）:消息和数据消费者</li></ul><p>实际上kafka的过程就是从生产者生产了数据放在Broker中，Broker承担一个中间缓存和分发的作用，负责分发注册到系统中的Consumer，实际上Consumer通过主动取数据的方式能够取到kafka中的消息，这一个整体的流程就是kafka作为一个消息队列的整个过程。在这里Broker可以看做一个服务器集群，他们通过zookeeper进行负载均衡。此外还有一些术语，包括topic，partition，以及message，kafka将消息组合为一个或多个topic进行存储，实际上topic就是某一类消息的汇总，我们可以将其理解为一个文件名，或者是一个文件描述，在topic之下有partition，partition为消息存储的实际结构，一个topic的消息可以保存到多个partition中供消费者读取，每个消息都被标识了一个递增序列号代表其进来的先后顺序，并按顺序存储在partition中。这个标识在kafka中称为id，实际上消费者能够通过id以及其偏移量进行随机的读取消息，实现了消息的灵活读取。<br>&nbsp;&nbsp;&nbsp;&nbsp;作为一个消息队列，kafka提供了消息持久化的功能，即消息能够保存到文件中进行持久化，同时kafka也支持备份机制，对于kafka来说，所有Node都提供一份完整备份，也就是说当有N个副本时，N个副本都在ISR中，N-1个副本都出现异常时，系统依然能提供服务。具体的kafka的消息持久化和备份机制可以参看<a href="https://kafka.apache.org/" target="_blank" rel="noopener">kafka官网介绍</a>。  </p><h2 id="Kafka应用实践"><a href="#Kafka应用实践" class="headerlink" title="Kafka应用实践"></a>Kafka应用实践</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;kafka做为一个消息队列，其设计是十分精巧的，但是他的使用和部署方法却是十分方便，在windows下也能够方便的进行部署和使用，正常情况下按照<a href="https://blog.csdn.net/woshixiazaizhe/article/details/80610432" target="_blank" rel="noopener">参考资料</a>都能够部署成功，但是有几个问题是需要确认的，第一个问题在于kafka的版本，在我尝试过程中3.5以上的版本在部署的过程中可能出现问题，因此建议采用3.4.X的版本部署。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Kafka是最初由Linkedin公司开发，是一个分布式、支持分区的（partition）、多副本的（replica），基于zookeeper协调的分布式消息系统，它的最大的特性就是可以实时的处理大量数据以满足各种需求场景：比
      
    
    </summary>
    
      <category term="学习" scheme="http://www.wuweiblog.com/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="系统架构 学习" scheme="http://www.wuweiblog.com/tags/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84-%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>矢量切片理论与实践</title>
    <link href="http://www.wuweiblog.com/2019/10/28/%E7%9F%A2%E9%87%8F%E5%88%87%E7%89%87%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5/"/>
    <id>http://www.wuweiblog.com/2019/10/28/矢量切片理论与实践/</id>
    <published>2019-10-28T02:39:09.000Z</published>
    <updated>2019-08-20T06:40:02.000Z</updated>
    
    <content type="html"><![CDATA[<p>&nbsp;&nbsp;&nbsp;&nbsp;矢量数据则是试图利用点、线、面等几何要素来表现这个世界，其数据结构紧凑精准，数据图形质量好，有利于地理信息检索与网络传输等。其中矢量数据的最小单元是以点的形式存在，点构成线，线组成面，面构造出体。随着WebGIS的发展，对于数据展示与数据传输的要求也在不断提高，对于栅格数据来说，通过切片的方式进行动态渲染能够实现根据数据展示范围与层级的实时渲染，大大提高了数据加载效率，而对于矢量数据来说，如果矢量数据量比较大，则前端渲染则效率会出现明显下降，因此为了提高矢量数据渲染和展示能力，同时充分利用矢量数据无极缩放的能力，矢量切片的技术应运而生。</p><h2 id="矢量切片的理论基础"><a href="#矢量切片的理论基础" class="headerlink" title="矢量切片的理论基础"></a>矢量切片的理论基础</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;对于栅格数据的切片我们很好理解，通过影像采样的方式得到不同层级的影像，通过地理坐标到像素行列号的方法映射出地理坐标，相比于栅格数据切片方法，矢量数据虽然在原理上存在一定的相似性，但是由于矢量数据的特殊性，矢量切片与栅格数据切片还是存在一定的差异。<br>&nbsp;&nbsp;&nbsp;&nbsp;目前矢量切片主要有以下三种格式：GeoJSON，TopoJSON和MapbBox Vector Tile(MVT)，其中使用的比较广泛的为MVT格式，在栅格切片中每一个栅格为一张影像，影像样式无法进行修改与处理，而矢量切片，实际上是根据切片范围对矢量数据的描述进行切片，针对不同的范围加载不同的切片描述，而前端根据切片描述绘制出对应的矢量数据。实际上我个人理解为：类似影像数据，我们将矢量数据按照一定的切片规则分为不同的块，每个块能够对应一个地理范围，我们将这个地理范围内的数据以某一种绘制方式进行编码得到一个类似于影像的编码文件，前端根据展示的范围显示对应的编码块，并根据编码块进行渲染展示。</p><h2 id="矢量瓦片数据格式标准"><a href="#矢量瓦片数据格式标准" class="headerlink" title="矢量瓦片数据格式标准"></a>矢量瓦片数据格式标准</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://github.com/jingsam/vector-tile-spec/blob/master/2.1/README_zh.md" target="_blank" rel="noopener">MapbBox Vector Tile(MVT)格式标准参考</a>，实际上不同格式编码有着严格的标准，对于MVT格式来说，其标准是开源的切片标准，具体的标准格式可以参考标准文档，在这里我只对瓦片绘制的方式进行简要说明，矢量瓦片中的几何数据被定义为按照屏幕坐标绘制的形式，其中几何图形被简单的编码为指令和参数的形式（这里有点类似SVG文件但是又不太一样），具体的指令包括MoveTo，LineTo以及ClosePath，每一个指令被映射为一个编码，这样将数和ID映射到一个INT类型的数据中，其中最后3bit标识指令，前29bit标识指令执行次数，参数的编码和解码方式为：<br>$$<br>ParameterInteger = (value &lt;&lt; 1) ^ (value &gt;&gt; 31)\ value = ((ParameterInteger &gt;&gt; 1) ^ (-(ParameterInteger \&amp; 1)))<br>$$<br>得到编码和解码方式之后就可以通过一个数组来表示一个几何对象，对于不同的对象需要的操作是不同的，另外需要注意的是数据的编码是采用相对坐标的形式，每一个要素的后面数据点的坐标都是相对于前一个点来计算的，第一个点的坐标是相对于（0，0）点来计算的。<br>&nbsp;&nbsp;&nbsp;&nbsp;要素属性被编码为tag字段中的一对对整数。在每对tag中，第一个整数表示key在其所属的layer的keys列表的中索引号（以0开始）。第二个整数表示value在其所属的layer的values列表的中索引号（以0开始）。一个要素的所有key索引必须唯一，以保证要素中没有重复的属性项。每个要素的tag字段必须为偶数。要素中的tag字段包含的key索引号或value索引号必须不能大于或等于相应图层中keys或values列表中的元素数目。</p><h2 id="矢量切片生成方式"><a href="#矢量切片生成方式" class="headerlink" title="矢量切片生成方式"></a>矢量切片生成方式</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;矢量切片有很多生成方式，在这里我只介绍通过ArcGIS进行矢量切片数据的方式，ArcGIS在10.4以后就支持发布和切矢量切片了，其具体步骤为：<br>在ArcGIS Pro中构建矢量切片：  </p><ul><li>开启 ArcGIS Pro 并打开包含要发布的地图的工程。</li><li>请确保您的门户连接处于活动状态，且您已使用具有创建内容和发布托管切片图层权限的帐户登录到您的组织。</li><li>要发布切片图层，请执行以下操作之一：在内容窗格中选择这些图层。右键单击选择集，然后单击共享为 Web 图层。要在地图中发布所有图层，请在共享选项卡的共享为组中单击 Web 图层，然后单击发布 Web 图层。</li><li>输入切片图层的名称。图层默认保存到我的内容中。您可以通过输入子文件夹名称或浏览已有的文件夹将图层保存到我的内容的子文件夹中。</li><li>选择复制所有数据。</li><li>在图层类型中选择切片。这样会自动取消选中其他图层类型选项，因为复制数据时仅可选中一个选项。</li><li>提供切片图层的摘要和标签。</li><li>请指定应该访问托管切片图层的用户。发布的所有图层都会自动共享到您的组织内的个人工作空间中（我的内容），并选择共享的用户。</li><li>单击配置，然后单击配置 Web 图层属性按钮以指定缓存设置。</li><li>选择切片方案。</li><li>调整并拖拽细节层次条块来为您的切片图层指示最小和最大比例。在您更改最小和最大比例时，生成缓存的估计大小会发生改变。</li><li>选择构建切片缓存的时间和位置。</li><li>要允许用户下载地图切片以供离线使用，请选中允许客户端导出缓存切片。</li><li>如果选中了允许客户端导出缓存切片，请使用导出限制为字段指定客户端一次可离线使用的最大切片数量。</li><li>请单击内容选项卡来确认切片图层将会包含您所需的数据图层。</li><li>请单击分析来检查错误或故障。</li><li>解决错误和某些警告后，单击发布 。</li></ul><p>除了通过ArcGIS Pro构建和发布矢量切片外还可以通过ArcGIS Server通过要素服务发布和构建矢量切片，具体的方法参考<a href="https://enterprise.arcgis.com/zh-cn/portal/latest/use/publish-tiles.htm#ESRI_SECTION1_D7F82432E5DD479DA47B4C9DD657610E" target="_blank" rel="noopener">ArcGIS 官方文档</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;矢量数据则是试图利用点、线、面等几何要素来表现这个世界，其数据结构紧凑精准，数据图形质量好，有利于地理信息检索与网络传输等。其中矢量数据的最小单元是以点的形式存在，点构成线，线组成面，面构造出体。随着WebGIS的发展，对于数
      
    
    </summary>
    
      <category term="学习" scheme="http://www.wuweiblog.com/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="ArcGIS开发" scheme="http://www.wuweiblog.com/tags/ArcGIS%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>得到什么，放弃什么</title>
    <link href="http://www.wuweiblog.com/2019/09/28/%E5%BE%97%E5%88%B0%E4%BB%80%E4%B9%88%EF%BC%8C%E6%94%BE%E5%BC%83%E4%BB%80%E4%B9%88/"/>
    <id>http://www.wuweiblog.com/2019/09/28/得到什么，放弃什么/</id>
    <published>2019-09-28T01:05:07.000Z</published>
    <updated>2019-08-20T01:12:42.000Z</updated>
    
    <content type="html"><![CDATA[<p>&nbsp;&nbsp;&nbsp;&nbsp;前几天的时候看渡鸦的故事，渡鸦是一种以腐食为主的动物，故事说渡鸦发现了一只死去的河马，但是他们的喙无法啄开河马坚硬的皮肤，所以他们去找来鬣狗帮助，鬣狗过来之后渡鸦们就在边上等候，等待把河马坚硬的皮咬开，并且吃饱之后再过去吃鬣狗们剩下的内脏等。本身这个故事并没有什么，就是说渡鸦其实是一种智商很高的生物，它们不仅会使用工具甚至会利用和训话其他动物。当然让我触动的不是他们多高的智商，毕竟作为人类，我们已经是这个星球上智商最高的动物了，让我感慨的是渡鸦们很清楚自己需要什么，自己应该放弃什么，这个其实是很难得的。<br>&nbsp;&nbsp;&nbsp;&nbsp;以前看电影的时候有句台词说小孩才做选择，成年人就会说我都要，当时觉得这句话很牛逼，把这句话奉为圭臬然后还自以为掌握了这个成年人世界的真相了，但是当自己被生活强奸了两年之后我发现，电影毕竟是电影，它不能代表这个社会运转的真相，没有人能够都要，不管是成年人还是小孩都会面临很多的选择。而在选择中我们更重要的是学会放弃，排队的时候总是觉得别人的队排的比较快，但是当我们换一个队后又发现自己原来的队突然加快了速度，这是多么痛的领悟～。我都要是本能，我们当然都希望自己能够得到所有的好东西，说出我都要这件事请并不丢人，但是我们内心应该明白，这是一件不可能的事情。<br>&nbsp;&nbsp;&nbsp;&nbsp;在这么纷繁复杂的社会中，既然无法什么都要，那我们的选择就变得十分重要了，我们自己是否真的明白我们所需要的是什么，我们真正热爱的是什么，我们能够放弃什么，我们放弃的东西是否从长久来看确实是啊没有什么意义的，我们面临生活，面临工作，面临婚姻的时候，这些都是我们所需要思考的，我们无法获得完美的生活，无法找到完美的工作，无法找到完美的伴侣，所以我们得学会放弃。<br>&nbsp;&nbsp;&nbsp;&nbsp;说起来好像大家都明白，其实做起来却并不是那么容易，毕竟对于大多数人来说损失所带来的痛苦远远大于获得所带来的快乐，所以我们一定是会讨厌放弃，厌恶失去。前几天看完了安全感这本书，从书中学到了很多，也有了很多反思，也对自己的一些行为和想法有了新的认识。阻碍我们放弃的原因有很多，但是放弃带来的不安一定是其中一个重要的原因，总是会幻想另外的路上有不一样的风景，所以我们在挣扎，在纠结，我们失去了很多快乐。为了能够更加坦荡的进行选择和放弃，我们首先要明白自己在内心深处到底希望什么，我们希望忙碌而充实的生活，在普通的岗位上默默奉献？或者我们喜欢漂泊与自由，我们能够并且愿意去体会接受变化无常，又或者我们就喜欢在我们生长的地方，与父母为伴过着悠闲的生活？每一种生活状态都有着它的美好与艰难，我们要明白自己内心到底希望的是什么，然后坚定自己的选择。以前的时候我觉得口号什么的很空洞，但是随着年龄和阅历的增长，我觉得也许对于那些大人物来说，口号不仅仅是空洞的口号，而是真正需要坚持的东西吧！</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;前几天的时候看渡鸦的故事，渡鸦是一种以腐食为主的动物，故事说渡鸦发现了一只死去的河马，但是他们的喙无法啄开河马坚硬的皮肤，所以他们去找来鬣狗帮助，鬣狗过来之后渡鸦们就在边上等候，等待把河马坚硬的皮咬开，并且吃饱之后再过去吃鬣狗
      
    
    </summary>
    
      <category term="随感" scheme="http://www.wuweiblog.com/categories/%E9%9A%8F%E6%84%9F/"/>
    
    
      <category term="随感" scheme="http://www.wuweiblog.com/tags/%E9%9A%8F%E6%84%9F/"/>
    
  </entry>
  
  <entry>
    <title>瞎扯什么</title>
    <link href="http://www.wuweiblog.com/2019/09/18/%E7%9E%8E%E6%89%AF%E4%BB%80%E4%B9%88/"/>
    <id>http://www.wuweiblog.com/2019/09/18/瞎扯什么/</id>
    <published>2019-09-18T12:30:07.000Z</published>
    <updated>2019-08-12T05:34:44.000Z</updated>
    
    <content type="html"><![CDATA[<p>&nbsp;&nbsp;&nbsp;&nbsp;在去江门的路上，由于没有赶上七点的那一班车，所以只能坐晚上八点半的车，以前的时候特别不喜欢出差，因为家里养了一条菜包狗，狗子很黏人，如果出差几天不回来的话就会害怕，所以我都不太愿意出差，即使出差也想着能够早一点回家，后来狗子也不在了，一个人生活了有一段时间，在这段时间内实际上家对我来说也就是晚上一个过夜的地方而已，这一段时间对出差还是挺喜欢的，毕竟住酒店比家里要住的舒服，而且出差还有补贴能够挣点钱。其实我也没有变，事情也没有变，但是对于出差的看法变得不一样了，这其实也是挺有意思的事情。<br>&nbsp;&nbsp;&nbsp;&nbsp;其实一个人坐在车上的时候就能够比较仔细的思考问题，对于我们自己，对于事情，对于各种各样的事情都有一些不一样的看法，听了一个脱口秀是关于孤独的，我觉得讲的还挺有意思的，我们在这诺大的城市里面，几千万的人群中，说实话不应该感到孤独，但是那个故事让我记忆很深刻，一个看坟的人，家里停电了，手机也没有电了，在茫茫的坟地里，漆黑的夜晚，他此时此刻最想的事情和最害怕的事情就是有人跟他说说话。多么有趣的故事，多么矛盾的心里。其实我们在这个几千万人的茫茫城市中所面临的大概也是同样的问题吧，我们多么想能够找人说说话，可是又多么害怕有人说说话。<br>&nbsp;&nbsp;&nbsp;&nbsp;我有时候在想，我爸妈他们在我这个年纪的时候在做什么，在想什么，他们会不会跟我一样也感觉到这么大的压力，这么困惑。每次打电话回家的时候其实都想问这个问题，但是好像又问不出口，每次跟他们想要说这个问题的时候他们总是觉得我矫情，似乎好像我现在拿着不错的薪资，又有了自己的房子，一切似乎都这么的好，似乎比他们当年幸福百倍，没到这个时候我总是无法接话，我不知道该怎么跟他们解释这个问题，好像他们说的也对，但是跟我自己的体会还是有比较大的差距。到底是我自己的体会是对的呢还是他们的看法是对的呢？这原来也是一个问题，<br>&nbsp;&nbsp;&nbsp;&nbsp;有时候想想说有钱真好，可以做自己喜欢做的事情，可是如果真的让我有钱了，又有什么事情是我能够坚持一生喜欢做的事情呢？或者我还没有做好有钱的准备？不过我觉得普通人也挺好，以前的时候爱做梦，总是希望梦到自己一夜暴富或者额突然家里很有钱，但是这个前提是我依然是我，我依然是按照我现在的生活过这一生，其实想想我对自己现在的生活好像也挺满意的，只是有好像缺了点啥一样，真是有点奇怪。有时候在想，其实写代码也算是一种创造性的工作了吧，毕竟水染我写的代码可能不够好，总是这个世界上独一无二的一段代码，总是包含了我对一个事情的理解，其中还是有些快乐的吧。<br>&nbsp;&nbsp;&nbsp;&nbsp;这两天听到我们这个业主升职了，其实我心里还是很开心，由衷的开心，因为这个业主是一个技术型的人，而不是一个管理型的人，这样的人能够得到认可，能够升职其实说明我们这个评价体系还是比较好的，这对我来说应该是一个巨大的鼓舞。有时候挺羡慕梓萌，虽然她也跟我有过吐槽，实际上其实在我眼里她是一个很幸福的人，有些时候她跟我吐槽或者我跟她说我以前打工或者做社团的经历的时候她可能只是觉得有趣，而当时的我是确确实实需要去打工挣钱，毕竟人类的悲喜并不相同。我们很难真正设身处地的想着别人，不过我们起码应该尊重别人的努力和坚持。以前看到过一篇文章《我努力了二十年才能跟你们一样坐在星巴克喝咖啡》其实我想说的是，我差不多也努力了二十年才能呢跟你们一样安心坐在星巴克不喝咖啡。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;在去江门的路上，由于没有赶上七点的那一班车，所以只能坐晚上八点半的车，以前的时候特别不喜欢出差，因为家里养了一条菜包狗，狗子很黏人，如果出差几天不回来的话就会害怕，所以我都不太愿意出差，即使出差也想着能够早一点回家，后来狗子也
      
    
    </summary>
    
      <category term="随感" scheme="http://www.wuweiblog.com/categories/%E9%9A%8F%E6%84%9F/"/>
    
    
      <category term="随感" scheme="http://www.wuweiblog.com/tags/%E9%9A%8F%E6%84%9F/"/>
    
  </entry>
  
  <entry>
    <title>早起杂感</title>
    <link href="http://www.wuweiblog.com/2019/09/12/%E6%97%A9%E8%B5%B7%E6%9D%82%E6%84%9F/"/>
    <id>http://www.wuweiblog.com/2019/09/12/早起杂感/</id>
    <published>2019-09-11T22:02:07.000Z</published>
    <updated>2019-08-07T18:30:16.000Z</updated>
    
    <content type="html"><![CDATA[<p>&nbsp;&nbsp;&nbsp;&nbsp;今天起的特别早，也不知道为什么感觉起来之后好像就没有了睡意，其实昨晚睡的也并不算早。不过早起还是有好处的，最主要的好处就是有时间在这里胡思乱想。最近总是又能看到一些关于90后的话题甚嚣尘上，其实我在想，我们90后到底做错了什么需要引起如此广泛的关注，其实不过都是自媒体们在吃蘸着人血的馒头而已。为什么一定要给某一些人强行钉上那些有的或者是没有的标签呢，每一个人都有各自的艰辛，只不过这其中的种种事情不足为外人道而已。<br>&nbsp;&nbsp;&nbsp;&nbsp;前两天给小鹏哥打了个电话，跟小鹏哥一起聊聊天感觉很开心，小鹏哥好像也挺有心事的，我想恐怕结婚生小孩儿之后的生活虽然幸福但是也难免面临着一些不愉快吧，其实我也有思考，我们究竟应该一个人生活还是有一个家庭，每当我想到这些的时候我就觉得，其实有个人陪着一起生活也是一个不错的选择。我自己并不是一个多么特立独行的人，很早就明白其实自己只是一个普通人而已，我只想做一些普通的事情，随着人群其实也挺好。以前看书的时候看到那本《乌合之众》，了解到群体无意识，当时还觉得自己应该做一个与众不同的人，而不是在人群中做一个行尸走肉，但是随着年龄慢慢增长，这样的想法也越来越淡。正如跟几个师兄聊天的时候所说，其实到了工作中才发现，工作真的就是为了糊口而已，而更加努力的工作只是因为有一种需要把事情做好的责任感而已，我们并没有谈论理想的奢望。<br>&nbsp;&nbsp;&nbsp;&nbsp;所以最近总是努力的将工作和生活分开，以前的时候我对把工作和生活分开这样的说法是很排斥的，可是现在我却深以为然，确实应该将工作和生活分开，否则会感觉到太压抑，由此影响到正常的生活。仔细想想其实我们工作的目的不过就是为了好好生活而已，可是到底什么才是好好生活，这确实是一件很值得思考的问题，起码至少有两种生活态度，应该随心所欲还是十分自律，有时候感觉很矛盾，而这个矛盾的根源在于我们作为人，并不是独立于社会而存在的，我们无时无刻不生活在他人的眼光和生活之中，或者至少生活在我们父母亲人的眼光之中，而作为一个社会性的人，我们就不得不考虑他人的看法，由此我们就需要平衡自我与他人的关系，我们想要吃垃圾食品，因为吃起来爽，我们又想要一个好身材能得到众人的认可；我想要瘫倒在家当咸鱼，但是又不得不面临大家异样的目光，所以我们必须在这两个矛盾之中进行选择，学会调和。<br>&nbsp;&nbsp;&nbsp;&nbsp;如果矛盾在于此其实也就不难理解为什么90后这一代人的矛盾特别大，我们的成长伴随着自我意识的醒觉和社会联系方式的转变，一方面受教育程度的提高与独生子女的政策让我们自我意识得到了提高，另一方面，随着互联网的发展我们的社会属性也得到了空前的加强，由此而带来的矛盾便一直存在。可能今天起的比较早，想的东西也比较杂，差不多快到上班时间了，还是收拾收拾了去上班吧。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;今天起的特别早，也不知道为什么感觉起来之后好像就没有了睡意，其实昨晚睡的也并不算早。不过早起还是有好处的，最主要的好处就是有时间在这里胡思乱想。最近总是又能看到一些关于90后的话题甚嚣尘上，其实我在想，我们90后到底做错了什么
      
    
    </summary>
    
      <category term="随感" scheme="http://www.wuweiblog.com/categories/%E9%9A%8F%E6%84%9F/"/>
    
    
      <category term="随感" scheme="http://www.wuweiblog.com/tags/%E9%9A%8F%E6%84%9F/"/>
    
  </entry>
  
  <entry>
    <title>好好生活</title>
    <link href="http://www.wuweiblog.com/2019/09/02/%E5%A5%BD%E5%A5%BD%E7%94%9F%E6%B4%BB/"/>
    <id>http://www.wuweiblog.com/2019/09/02/好好生活/</id>
    <published>2019-09-02T14:19:07.000Z</published>
    <updated>2019-08-03T14:23:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>&nbsp;&nbsp;&nbsp;&nbsp;很多时候我都在说要好好生活，但是其实到底怎么样才是好好生活，到现在也没有搞清楚。很久没有看书了，最近去广州局上班，每天通勤时间太长，每次都是在车上睡觉，其实我想着能在车上处理一些杂事，但是事实证明在车上除了睡觉其实啥也干不了，因为特别累，所以也就放弃干点别的事情的想法专心睡觉了。以前菲总说通勤时间超过一个小时，得抑郁症的几率会上升，对此我深以为然，在广州局工作确实感觉到人变得抑郁了很多，不过我觉得我的自我调节能力还是比较强的，总是能够在生活中找到一点点的乐趣，不然确实挺难受的。<br>&nbsp;&nbsp;&nbsp;&nbsp;其实最近一直觉得有点奇怪，觉得焦虑，但是说不出原因，后来我大概想明白了，其实我焦虑的主要原因是我没有学会放弃一些东西。说白了生活中总是会面临很多的选择，如果什么都想要可能什么都得不到。所以最近一直都想着要把工作和生活给分开，而这么做的第一步就是不把工作带回家，以前的时候总是想着能够在家里工作，所以不管是在公司还是在家都想着要干活，但是在家一般都干不了活，总是陷入深深的焦虑当中，事实证明，如果能够放下这样的自责和焦虑，整个人会轻松很多。这样玩起来也不会觉得有负罪感，更重要的一点是通过这样的做法，在工作中能够使自己更加集中精神去工作，因为没有回家再做这个选项，所以在工作中能够更深入的思考工作的优先顺序，同时也能够更快速的完成工作，总的来说这个选择目前来看应该是没有问题的。不过生活也并不是总是设计好的，很多时候难免会有些遗留的工作，也许应该想个法子才好，不过起码目前没有这样的问题了。<br>&nbsp;&nbsp;&nbsp;&nbsp;有时候我也在想，为啥自己总是间歇性努力，间歇性抽风，感觉好像没有持续很长时间努力学习工作的动力，我想到了自己读书和考研的时候，那个时候挂科了说要考的时候，感觉已经到了世界末日了，但是随着自己慢慢的进入复习又感觉其实一切都还挺好的，所以那个时候我就开始弄清楚一个道理，其实当前我们所困惑和在意的东西其实以后可能回过头来看，也并没有那么重要。但是对于我们自己来说什么事情是最重要的呢？我觉得应该算理想，或者说是梦想了吧，我仔细想想好像自己压力也不应该这么大，毕竟也不是到了吃不上饭的时候，那更重要的应该是生活的追求了吧，我想以后大家也都会这样，我们热爱生活，享受生活，这个才是生活的真谛，如果我们都不热爱生活了，那么工作得再好钱挣的再多好像也是意义不大，毕竟如果生活都没有了，工作能给我们提供什么呢？</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;很多时候我都在说要好好生活，但是其实到底怎么样才是好好生活，到现在也没有搞清楚。很久没有看书了，最近去广州局上班，每天通勤时间太长，每次都是在车上睡觉，其实我想着能在车上处理一些杂事，但是事实证明在车上除了睡觉其实啥也干不了，
      
    
    </summary>
    
      <category term="随感" scheme="http://www.wuweiblog.com/categories/%E9%9A%8F%E6%84%9F/"/>
    
    
      <category term="随感" scheme="http://www.wuweiblog.com/tags/%E9%9A%8F%E6%84%9F/"/>
    
  </entry>
  
  <entry>
    <title>狗子日记十一月四号</title>
    <link href="http://www.wuweiblog.com/2019/09/02/%E7%8B%97%E5%AD%90%E6%97%A5%E8%AE%B0%E5%8D%81%E4%B8%80%E6%9C%88%E5%9B%9B%E5%8F%B7/"/>
    <id>http://www.wuweiblog.com/2019/09/02/狗子日记十一月四号/</id>
    <published>2019-09-01T16:30:05.130Z</published>
    <updated>2017-11-05T14:28:06.000Z</updated>
    
    <content type="html"><![CDATA[<p>下午的时候刘艳在家打扫卫生，她突然很激动的跟我说：＂我捡到了一粒黑色的扣子！＂<br>我表示一脸茫然，怎么会有黑色扣子，难道是哪件衣服上掉的？于是我说：＂黑色扣子，怎么会有黑色扣子？＂<br>随后又传来一声尖叫:”啊～～～！”<br>把我吓了一跳，＂怎么啦！＂我赶紧问．然后出去看看发生了啥.<br>她看到我出来又很激动的跟我说：＂那个不是黑色的扣子，那个是菜包的屎，沾上了它的毛～气死我啦！＂<br>于是我们转头看向菜包，正趴在地上的菜包感觉到了我们两个人充满杀气的目光突然惊恐的站了起来：＂你们要干啥！你们不要这么看着本大王~＂<br>于是我们开始质问:”菜包，你怎么把你的粑粑弄到客厅来了~”<br>菜包一脸茫然：＂你在说什么，我完全听不懂的样子!＂<br>我们满头黑线:”….你又在装，看来每天不揍你你就不舒服呀！”，于是我抄起了我的拖鞋．<br>菜包吓得赶快翻肚皮：＂我冤枉呀～，我真的什么都不知道，你们就是打死我也没有用呀~＂<br>本着宁可错杀一千不能放过一个的原则，我们依然把菜包揍了一顿，然后心满意足的回房间了.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;下午的时候刘艳在家打扫卫生，她突然很激动的跟我说：＂我捡到了一粒黑色的扣子！＂&lt;br&gt;我表示一脸茫然，怎么会有黑色扣子，难道是哪件衣服上掉的？于是我说：＂黑色扣子，怎么会有黑色扣子？＂&lt;br&gt;随后又传来一声尖叫:”啊～～～！”&lt;br&gt;把我吓了一跳，＂怎么啦！＂我赶紧问．然后
      
    
    </summary>
    
      <category term="小说" scheme="http://www.wuweiblog.com/categories/%E5%B0%8F%E8%AF%B4/"/>
    
    
      <category term="狗子日记" scheme="http://www.wuweiblog.com/tags/%E7%8B%97%E5%AD%90%E6%97%A5%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>不读书（八）</title>
    <link href="http://www.wuweiblog.com/2019/08/20/%E4%B8%8D%E8%AF%BB%E4%B9%A6(%E5%85%AB)/"/>
    <id>http://www.wuweiblog.com/2019/08/20/不读书(八)/</id>
    <published>2019-08-20T03:38:44.000Z</published>
    <updated>2019-08-20T11:24:26.000Z</updated>
    
    <content type="html"><![CDATA[<p>&nbsp;&nbsp;&nbsp;&nbsp;最近看完了这两本书，其中《中国经济2019》我是听完的，第二本书是一本小说，也只是走马观花的看了一遍。总是感觉很多时候都没有心思去看书，长时间专注的做一件事情了，这样的感觉越发的强烈，跟很多人聊天的时候发现他们也有差不多的感觉。归根结底其实是由于时代的进步，智能设备的应用导致我们的精力被严重分散，那些应用，那些游戏和App，所有的这一切都是为了抢占我们的有效时间。所以那些披着精致外衣的App，他们所给我们带来的可能不不是我们想要的，那些抢占我们时间的只是一些让我们沉迷其中的奶头乐而已。<br>&nbsp;&nbsp;&nbsp;&nbsp;以上的感慨跟我这段时间读的书都没有什么关系，主要是一直在感觉自己变得功利，无法集中精神去做某一件事情，这样的感觉让我很难受。这段时间主要读了以上两本书，如果让我做一个推荐的话我估计两本书都不会推荐，其实两本书都是那种低密度信息量的书，第一本《中国经济2019》原以为能够有一些好的见解或者是看法，但是实际上这本书让我很失望，这本书只是一本总结性的书籍，书中总结了很多2018-2019年以来的大事件，对于互联网经济，房价，贸易战等诸多的政治经济大事件都有很详细的描述和总结，也罗列了很多数据，但是实际上并没有太多的思想与见解，通过这本书也只是能够对中国经济有一个数字或者宏观事件上的认识，作为一个经济报告，实际上并没有太多能够引起人兴趣的地方，如果想要了解一下2018-2019年大事件，这本书当然是一个很不错的选择，但是除此之外好像感觉不到这本书的其他作用了，仅仅是作为谈资而已吧。不过可能实际上宏观经济情况本来就不是有多么强的规律，看不见的手与看的见的手相互作用下几乎没有哪个经济学家能够对宏观经济做出准确的判断，所以作者只是列出类似报告一样的东西也是能够理解的吧。总的来说这本书是数据和内容很丰富，但是思考的不够深入，没有能够提出有见地的思想。<br>&nbsp;&nbsp;&nbsp;&nbsp;其实我倒是很想好好看一些小说，但是又总是觉得看小说既浪费时间又没有太大的意义，我觉得这恐怕也是功利心的体现吧，不过还是花钱买了本《时间的答案》这本电子书，当初买这本书是因为本书的作者好像也是一个三十不到的年轻人，我想看看他们的生活与感悟也许会对自己的有些帮助吧，书介绍了作者大学生活，不得不说其实看完还是有些失望。虽然好像年龄差不多，但是感觉好像他们的烦恼和想法也与我相去甚远，甚至与我周围的人的想法也想去甚远，有时候我都怀疑人家与我过的是不是同一种生活。还是说其实是因为家庭条件的原因，所以我们的想法和选择会有很大的区别。回到这本书上，也许作者是想表达对人生选择的思考，但是很多事情在我看来都太过矫情，很多说教和道理都太过空洞，让人无法接受。不过也许是因为我年龄已经到了这个年纪，我想一个快三十多岁的人，当他面临这社会的压力的时候很多关于爱情，关于选择的问题就会简单很多，或者说其实我们没有什么选择，又或者说其实我们认识到其实自己没有什么选择，也许对一个刚进大学，或者是还在高中憧憬大学生涯的小朋友们来说是一本不错的书，可惜对于我，它晚来了十年。不过这个书名倒是挺有意思的，“时间的答案”，所有问题时间都会给出一个答案，好的或坏的，我们除了接受其实并没有什么很好的办法。生活其实是需要智慧和清醒认识的，我以前发了一个状态叫“不忘初心”，以前一直觉得这样的口号是多么的空洞，但是随着有了一点点生活的阅历，我渐渐发现这句话其实是很接地气的一句话，我们每一个人，步入这个社会的时候总是对自己有一个认识和定位，这个我们暂且叫初心吧，然后随着我们在这个社会中的成长，初心就渐渐的好像配不上我们的职位了，但是其实说到底我们只是见多了一些人，做多了一些事情，然后多了很多欲望，所以我们总是会以为现在的自己要强于以前的自己，实际上可能正是因为多了这么多的Title，多了这么多外在的东西，我们对自己的认识反而变得模糊了，所以不忘初心其实真的很重要。<br>&nbsp;&nbsp;&nbsp;&nbsp;说了这么多东西，感觉又像啥都没说，不过相比于以前，现在应该算得上是好了很多，我渐渐的开始重视生活了，我想只要我开始重视生活了，我应该就能够渐渐的好好生活吧。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;最近看完了这两本书，其中《中国经济2019》我是听完的，第二本书是一本小说，也只是走马观花的看了一遍。总是感觉很多时候都没有心思去看书，长时间专注的做一件事情了，这样的感觉越发的强烈，跟很多人聊天的时候发现他们也有差不多的感觉
      
    
    </summary>
    
      <category term="书评" scheme="http://www.wuweiblog.com/categories/%E4%B9%A6%E8%AF%84/"/>
    
    
      <category term="中国经济2019,时间的答案" scheme="http://www.wuweiblog.com/tags/%E4%B8%AD%E5%9B%BD%E7%BB%8F%E6%B5%8E2019-%E6%97%B6%E9%97%B4%E7%9A%84%E7%AD%94%E6%A1%88/"/>
    
  </entry>
  
  <entry>
    <title>酷炫的动态图</title>
    <link href="http://www.wuweiblog.com/2019/07/21/%E9%85%B7%E7%82%AB%E7%9A%84%E5%8A%A8%E6%80%81%E5%9B%BE/"/>
    <id>http://www.wuweiblog.com/2019/07/21/酷炫的动态图/</id>
    <published>2019-07-21T04:14:37.000Z</published>
    <updated>2019-07-21T04:37:22.000Z</updated>
    
    <content type="html"><![CDATA[<p>&nbsp;&nbsp;&nbsp;&nbsp;以前总是看到别人开发的GIS软件上有很多酷炫的效果，虽然没有什么实际上的功能，但是看起来真的是很酷炫了，有时候自己就想怎么才能做到这么酷炫的效果呢，直到我遇到Echart这个图标工具，通过这个图标工具就可以做到很酷炫的动态图效果了，通过合适的动态图效果能够为我们软件增色不少。<br>&nbsp;&nbsp;&nbsp;&nbsp;首先我们需要一个js控件，叫eschartLayer.js可以直接放入ArcGIS SDK进行应用，也可以配置dojo进行引用，具体的引用方法在这里就不进行介绍了，在这里主要介绍一下这个控件的思路，具体的做法就是在地图层之上添加一个Div的遮罩层，这一层为Echart图表，然后坐标为当前数据显示范围，然后在这个基础上进行绘制，；利用Echart的图标添加各种动态效果，实际上动态效果就是根据Echart的配置功能进行配置，通过这样的方式实现地图动态效果的叠加。我们首先可以参看这个控件的<a href="https://github.com/slobber/arcgis-4-with-echarts-4" target="_blank" rel="noopener">Github地址</a>,通过他的例子可以看到一些迁徙图的动态效果，但是这些迁徙图动态效果都是点与点之间的，那么基于这个东西我就在思考，能不能做一个将ArcGIS Feature Layer转换为可展示数据的功能呢，为了实现这个目标，我写了两个函数:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*  数据转换方法，将查询到的Feature数据转换为Echart图表展示的形式</span></span><br><span class="line"><span class="comment">*  将Feature数据转换为Echart能够展示的点图层数据进行展示</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FeaturesConvertToPoints</span>(<span class="params">features,type</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> data=[];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;features.length;++i)&#123;</span><br><span class="line">    <span class="keyword">if</span>(features[i].geometry.type==<span class="string">'point'</span>)&#123;</span><br><span class="line">        data.push(&#123;</span><br><span class="line">        type:type,</span><br><span class="line">        value:[features[i].geometry.longitude,features[i].geometry.latitude]</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span>(features[i].geometry.type==<span class="string">'polygon'</span>)&#123;</span><br><span class="line">        data.push(&#123;</span><br><span class="line">        type:type,</span><br><span class="line">        value:[features[i].geometry.centroid.longitude,features[i].geometry.centroid.latitude]</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*  数据转换方法，将查询到的Feature数据转换为Echart图表展示的形式</span></span><br><span class="line"><span class="comment">*  将Feature数据转换为Echart能够展示的线数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FeatureConvertToLines</span>(<span class="params">features</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> data=[];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;features.length;++i)&#123;</span><br><span class="line">    <span class="keyword">if</span>(features[i].geometry.type==<span class="string">'polyline'</span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> paths = features[i].geometry.paths;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;paths.length;++j)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> k=<span class="number">0</span>;k&lt;paths[j].length<span class="number">-1</span>;++k)&#123;</span><br><span class="line">            data.push(&#123;</span><br><span class="line">            fromName:<span class="string">""</span>,</span><br><span class="line">            toName:<span class="string">""</span>,</span><br><span class="line">            coords:[paths[j][k],paths[j][k+<span class="number">1</span>]]</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>&nbsp;&nbsp;&nbsp;&nbsp;其实上面两段代码都比较简单，第一段代码是将点和面数据转换为Echart能够显示的散点图的散点信息，第二段代码为将线数据转换为可展示的线段的信息，在这里就要说一下ArcGIS的线数据存储格式了，线数据是按照Feature-&gt;paths-&gt;Points这个层级关系来进行存储的，首选获取Feature，然后获取Paths以及之下的点数据，为了实现点数据转换为Echart的格式，需要将点数据进行一些转换，然后在Echart中的Series的数据中对数据进行添加，展示效果为：<br><img src="https://blogimage-1251632003.cos.ap-guangzhou.myqcloud.com/%E7%BA%BF%E8%B7%AF%E5%8A%A8%E6%80%81%E5%B1%95%E7%A4%BA.gif" alt="动态线路数据展示">,如果大家有什么疑问也可以留言，大家一起探讨一下GIS数据的酷炫展示方式。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;以前总是看到别人开发的GIS软件上有很多酷炫的效果，虽然没有什么实际上的功能，但是看起来真的是很酷炫了，有时候自己就想怎么才能做到这么酷炫的效果呢，直到我遇到Echart这个图标工具，通过这个图标工具就可以做到很酷炫的动态图效
      
    
    </summary>
    
      <category term="学习" scheme="http://www.wuweiblog.com/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="ArcGIS开发" scheme="http://www.wuweiblog.com/tags/ArcGIS%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>激光点云数据三视图生成</title>
    <link href="http://www.wuweiblog.com/2019/07/02/%E6%BF%80%E5%85%89%E7%82%B9%E4%BA%91%E6%95%B0%E6%8D%AE%E4%B8%89%E8%A7%86%E5%9B%BE%E7%94%9F%E6%88%90/"/>
    <id>http://www.wuweiblog.com/2019/07/02/激光点云数据三视图生成/</id>
    <published>2019-07-02T09:17:55.000Z</published>
    <updated>2019-07-02T09:17:56.000Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>视差理解</title>
    <link href="http://www.wuweiblog.com/2019/05/26/%E8%A7%86%E5%B7%AE%E7%90%86%E8%A7%A3/"/>
    <id>http://www.wuweiblog.com/2019/05/26/视差理解/</id>
    <published>2019-05-26T07:17:57.000Z</published>
    <updated>2019-06-03T09:45:22.000Z</updated>
    
    <content type="html"><![CDATA[<p>&nbsp;&nbsp;&nbsp;&nbsp;为了说明什么是视差我特意画了下面一张图，虚线为辅助线，为了方便理解和计算，其中X为物方坐标，也就是空间中的一个点，Z为深度，f为焦距，对于点X在像平面上成的点分别为 $x$ 与 $x’$如下图：<br><img src="https://blogimage-1251632003.cos.ap-guangzhou.myqcloud.com/%E8%A7%86%E5%B7%AE%E7%A4%BA%E6%84%8F%E5%9B%BE.JPG?q-sign-algorithm=sha1&q-ak=AKIDKw07A0GWOXesL566U946vBTGY67TVRYl&q-sign-time=1558881330;1558883130&q-key-time=1558881330;1558883130&q-header-list=&q-url-param-list=&q-signature=74dcaf81ca045b8ce0bbc9d68ad28e16c17a0dee&x-cos-security-token=3897917274b469b893340d494453c417680cdd6410001">  </p><h2 id="1-视差定义与公式"><a href="#1-视差定义与公式" class="headerlink" title="1. 视差定义与公式"></a>1. 视差定义与公式</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;首先说一下视差的定义，我们所说的<a href="https://baike.baidu.com/item/%E8%A7%86%E5%B7%AE/4160990?fr=aladdin" target="_blank" rel="noopener">视差</a>就是从有一定距离的两个点上观察同一个目标所产生的方向差异，我们在摄影测量的视差图中所指的视差通常指的是左右视差而不是上下视差，<a href="https://baike.baidu.com/item/%E5%B7%A6%E5%8F%B3%E8%A7%86%E5%B7%AE/373299" target="_blank" rel="noopener">左右视差</a>为立体像对上同名像点横座标之差，若两个相机已经校正完成即达到极线平行，两条光轴方向也平行。则视差和物体深度的关系式(1)：<br>$$<br>\operatorname{dsparity}^{\prime} y=T_1x-T_2x^{\prime}=\frac{B f}{Z}  (1)<br>$$<br>为了说明式(1)的来历，我们做了一条$OX$的平行线过$O’$则$T_1x=T_2T_3$则根据三角形相似的原理我们可以推导出式(1)，在此基础上，假设视差已知，则深度计算为：<br>$$<br>Z=\frac{B <em> f}{T_1x-T_2x^{\prime}}=\frac{B </em> f}{d} （2）<br>$$<br>其中d为视差值，在成像过程中B与f都是常量，因此深度只与d有关，深度Z与视差d成反比关系，因此可以得出结论：<strong>视差越大则深度越小，则物点距离像平面坐标越近</strong>。</p><h2 id="2-视差计算方法"><a href="#2-视差计算方法" class="headerlink" title="2. 视差计算方法"></a>2. 视差计算方法</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;视差的计算是计算深度图的一个基础，从openCV中有一些部分是专门进行相机标定和视差计算的，我们把视差计算称为<strong>Stereo Matching</strong>，由上面描述的视差的定义与公式中可以了解到，视差的计算实际上有一个基础，那就是两张图像的同名点在同一水平线上，即图像的y坐标相同，为了达到以上效果，在视差计算前我们首先进行极线校正，首先通过sift算子解算得到匹配点，进而解算出影像之间的<a href="https://baike.baidu.com/item/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E4%B8%AD%E7%9A%84%E5%A4%9A%E8%A7%86%E5%9B%BE%E5%87%A0%E4%BD%95/8726537?fr=aladdin" target="_blank" rel="noopener">基础矩阵$F$与本质$E$</a>，注意到我们说的两个矩阵，两个矩阵实际上都是与极线相关的，图像上一个点乘以这个点的本质矩阵可以得到这个点在另一张图像上的极线方程，具体介绍可以参考<strong>计算机视觉中的多视图几何</strong>这本神书，建议阅读英文原版。求出基础矩阵与本质矩阵后就可以进行<a href="http://www.cs.ait.ac.th/~mdailey/cvreadings/Hartley-Rectify.pdf" target="_blank" rel="noopener">极线校正</a>，实际上分两种一种是没有经过内定标采用$F$举证进行的校正，另一种是采用$E$矩阵分接出R和T进行的校正在这里不多说。假设图像已经经过极线校正，则图像的y坐标应该相同，那么我们可以进行视差图计算，在视差图计算的过程中比较重要的一点是进行密集匹配，流行的密集匹配方法有BM方法、SGBM方法、GC方法等，在openCV中实现了前两种，因此我们在这里只讨论前两种方法  </p><h3 id="2-1-BM方法"><a href="#2-1-BM方法" class="headerlink" title="2.1 BM方法"></a>2.1 BM方法</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;BM方法，全称为<strong>Block Matching methods</strong>，方法说起来比较简单，我们可以通过一张示意图来描述：</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;为了说明什么是视差我特意画了下面一张图，虚线为辅助线，为了方便理解和计算，其中X为物方坐标，也就是空间中的一个点，Z为深度，f为焦距，对于点X在像平面上成的点分别为 $x$ 与 $x’$如下图：&lt;br&gt;&lt;img src=&quot;ht
      
    
    </summary>
    
      <category term="数学" scheme="http://www.wuweiblog.com/categories/%E6%95%B0%E5%AD%A6/"/>
    
    
  </entry>
  
  <entry>
    <title>激光点云处理工具介绍</title>
    <link href="http://www.wuweiblog.com/2019/04/21/%E6%BF%80%E5%85%89%E7%82%B9%E4%BA%91%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7%E4%BB%8B%E7%BB%8D/"/>
    <id>http://www.wuweiblog.com/2019/04/21/激光点云处理工具介绍/</id>
    <published>2019-04-21T13:18:16.000Z</published>
    <updated>2019-04-21T13:18:18.000Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>燃烧的巴黎圣母院</title>
    <link href="http://www.wuweiblog.com/2019/04/16/%E7%87%83%E7%83%A7%E7%9A%84%E5%B7%B4%E9%BB%8E%E5%9C%A3%E6%AF%8D%E9%99%A2/"/>
    <id>http://www.wuweiblog.com/2019/04/16/燃烧的巴黎圣母院/</id>
    <published>2019-04-16T13:34:18.000Z</published>
    <updated>2019-04-16T14:52:54.000Z</updated>
    
    <content type="html"><![CDATA[<p>&nbsp;&nbsp;&nbsp;&nbsp;今天被巴黎圣母院的新闻刷屏了，一座经历了几百年的著名建筑就这样在一场意外中几乎毁于一旦。对于此事我表示十分惋惜。其实巴黎圣母院距离我算是太过遥远，我知道这个建筑完全是通过雨果的著名小说。当然对于它所承载的文化内涵除了惋惜并没有太多其他的情绪，但是对于这件事情让我感触很深。<br>&nbsp;&nbsp;&nbsp;&nbsp;其实主要是对于什么才是永恒的话题的感触，这个问题太大我恐怕说不清楚，不过我可以谈谈我自己关于这个问题的一点点的看法。以前的时候很喜欢一句话“天地不仁以万物为刍狗，圣人不仁以百姓为刍狗”——《道德经》；另外就是子在川上曰的那句“逝者如斯乎，不舍昼夜”——《论语》。其实我觉得这两句表达的意思差不多，实际上就是对于时间流逝，世事无常的感慨，当然老子与孔子的哲学态度不太一样，我们就不要过多的去研究他们的思想了。实际上面对无尽的岁月我们作为这个地球上可能是唯一能够思考永恒话题的生物，我们自然会想的更多。所以古代帝王会有想着长生不老，会有费尽心思修建恢弘的帝陵。其实这些都是对于永恒的尝试吧。<br>&nbsp;&nbsp;&nbsp;&nbsp;其实我们自己又何尝不是这样，有的人喜欢保留着过去的小玩意，有的人珍惜过去的朋友，有的人怀念住过的城市，有的人思念已经离开的人。我们把他们藏在盒子中，藏在记忆中，藏在内心的最深处希望能够永恒。可是大部分其实都洒在了岁月的长河中，其实我觉得对于失去我们好像并不需要过于感慨或者是悲伤，除了明天升起的太阳，没有什么能够在岁月中永恒。作为一个建筑巴黎圣母院被烧毁了，但是对于我来说他并没有妨碍我在《巴黎圣母院》体验到爱与善良，或者有机会我么能够去见证那个毁于大火的建筑，也不能破坏我心中的美好形象。<br>&nbsp;&nbsp;&nbsp;&nbsp;所以虽然我们所珍惜的东西也会遗失在岁月的长河中，其实这并不可惜，更加不需要去悲伤，我想我们所珍惜的每一个东西，每一个人，他们都有着自己的使命，当他们完成了自己的使命后就离开了，而我们也获得了他的馈赠，当然我们也会以同样的方式馈赠给我们生命中所遇到的其他人。“只要是春风吹到的地方，到处是1青青野草野草”——有的人</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;今天被巴黎圣母院的新闻刷屏了，一座经历了几百年的著名建筑就这样在一场意外中几乎毁于一旦。对于此事我表示十分惋惜。其实巴黎圣母院距离我算是太过遥远，我知道这个建筑完全是通过雨果的著名小说。当然对于它所承载的文化内涵除了惋惜并没有
      
    
    </summary>
    
    
      <category term="随感" scheme="http://www.wuweiblog.com/tags/%E9%9A%8F%E6%84%9F/"/>
    
  </entry>
  
  <entry>
    <title>ArcGIS开发相关技术总结1</title>
    <link href="http://www.wuweiblog.com/2019/01/18/ArcGIS%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BB%931/"/>
    <id>http://www.wuweiblog.com/2019/01/18/ArcGIS开发相关技术总结1/</id>
    <published>2019-01-18T02:39:09.000Z</published>
    <updated>2019-01-18T07:27:14.000Z</updated>
    
    <content type="html"><![CDATA[<p>&nbsp;&nbsp;&nbsp;&nbsp;专心做了两个月的GIS开发，使用的是ArcGIS的平台，遇到了很多问题，对ArcGIS的API的使用有了更多的体会，另外对于js前端开发也有了更深刻的体会我将就最近做的这个项目集中总结一下在使用ArcGIS API的过程中所遇到的问题以及解决方式：</p><ul><li>问题1 Feature查询</li></ul><p>&nbsp;&nbsp;&nbsp;&nbsp;这个问题是一个很基础的问题，但是一直没有引起我的重视，直到这次进行开发才重视起来，实际上查询查询很有意思，主要有两种方式，实际上两种方式都差不多，之所以要提两种方式是因为并不是所有人都会直接使用ArcGIS js API对接ArcGIS Enterprise的平台，也许有人用OpenLayer有人用Cesium，在使用这些平台的时候我们所提到的第二种方式就很有意义了；第一种方式是直接通过FeatureLayer的Query函数进行查询，具体实现方式为：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 根据查询语句进行查询</span></span><br><span class="line"><span class="comment">    * @param &#123;*&#125; whereStatment：查询语句</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">queryTask:<span class="function"><span class="keyword">function</span>(<span class="params">layer,whereStatment</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> query = layer.createQuery();</span><br><span class="line">    query.outFields=[<span class="string">"*"</span>];</span><br><span class="line">    query.where=whereStatment;</span><br><span class="line">    <span class="keyword">return</span> layer.queryFeatures(query);</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 根据范围进行查询</span></span><br><span class="line"><span class="comment">    * @param &#123;*&#125; pt:几何信息</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">queryGeometryTask:<span class="function"><span class="keyword">function</span>(<span class="params">layer,pt,whereStatment</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> query = layer.createQuery();</span><br><span class="line">    query.outFields=[<span class="string">"*"</span>];</span><br><span class="line">    query.where=whereStatment;</span><br><span class="line">    query.geometry=pt;</span><br><span class="line">    <span class="keyword">return</span> layer.queryFeatures(query);</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 根据范围where语句和字段进行查询</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">queryGeometryTaskFiled:<span class="function"><span class="keyword">function</span>(<span class="params">layer,pt,whereStatment,field</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> query = layer.createQuery();</span><br><span class="line">    query.outFields=[field];</span><br><span class="line">    query.where=whereStatment;</span><br><span class="line">    query.geometry=pt;</span><br><span class="line">    <span class="keyword">return</span> layer.queryFeatures(query);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>以上是几个直接利用FeatureLayer进行查询的代码封装，实际上就是利用<strong>createQuery</strong>函数创建一个查询对象然后给查询对象查询条件然后进行查询。这个没有什么好说的，如果想要进一步的了解的话可以查询<a href="&quot;https://developers.arcgis.com/javascript/latest/api-reference/esri-layers-FeatureLayer.html&quot;">官网</a>的说明。<br>&nbsp;&nbsp;&nbsp;&nbsp;下面我们来聊聊第二种查询方式，直接通过RESTAPI来查，相比于上面集成进ArcGIS js API中的查询方式，通过RESTAPI的查询方式要复杂很多，实际上对于一个发布的数据，我们进入它的服务地址，然后点击query可以看到很多查询条件实际上查询出来的结果是一个soap的结果，为了得到json数据我们在查询的时候需要添加上&amp;f=json这个查询条件，通过这个查询条件可以查询到json格式的数据包括属性和位置信息，然后拿到这个数据后自己构建需要展示的数据，对于不同的平台和API展示数据的构建形式都不同，在这里就不一一进行演示了。虽然这样的方式相对比较复杂，但是具有更加广泛的适用性，如果以后适用不太API进行开发这也不失为一种方案。</p><ul><li>问题2 三维实体的查询</li></ul><p>&nbsp;&nbsp;&nbsp;&nbsp;这个问题是一个很有代表性的问题，在三维需要日益发展的今天GIS的呈现方式也由过去的二维为主发展到目前的三维为主，而ArcGIS中也有了SceneLayer这样一个展示三维数据的图层。一切看似很美好，但是有一朵乌云总是悬在头顶，那就是SceneLayer的查询。<br><strong>queryExtent()：</strong>    Promise<object>    Executes a Query against the service and returns the 2D Extent of features that satisfy the query.more details    SceneLayer<br><strong>queryFeatureCount()：</strong>    Promise<number>    Executes a Query against the service and returns the number of the features that satisfy the query.more details    SceneLayer<br><strong>queryFeatures()：</strong>    Promise<featureset>    Executes a Query against the service and returns a FeatureSet.more details<br>上面三个函数式SceneLayer有关查询的函数，看似好像都差不多实际上与FeatureLayer的查询功能相比SceneLayer的查询功能弱了很多，从官网的细节介绍可以看到：<font color="#ff0000"><strong>The query succeeds only if the layer’s supportsLayerQuery capability is enabled.</strong></font> 这句话很重要，它说需要支持LayerQuery才能拿进行查询，而如果才能够支持呢，需要在发布的时候link一个FeatureLayer，如何link呢需要通过Pro去发布，如果直接导出为SLPK的话是没有的，这个是社区的<a href="https://community.esri.com/message/645017-re-js-api-scene-layer-queryfeatures-throw-scenelayerquery-not-available-error?commentID=645017#comment-645017" target="_blank" rel="noopener">ESRI技术人员的回答</a>，关于这个问题我向ESRI的技术支持也询问过，他们似乎也不知道具体怎么弄，所以查询我就放弃采用这种方式了，但是看官网的例子可以看出如果数据是合理的应该是可以查询到的；这种方式不行就换一个方式，直接通过SceneLayerView进行查询，这样查询很好但是必须少于10000个要素，实际上同时展示的要素大于10000个的情况也不会太多，这个时候我采用的做法是先zoomIn，减少视野内要素个数，然后进行查询，具体的操作代码为：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 从图层呢个veiw中搜索出相关建筑实体并高亮展示</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">searchHighLightBuildingTransIDs:<span class="function"><span class="keyword">function</span>(<span class="params">layer,transIds</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> query = <span class="keyword">new</span> Query();</span><br><span class="line">    query.outFields=[<span class="string">"*"</span>];</span><br><span class="line">    <span class="keyword">this</span>.view.whenLayerView(layer).then(<span class="function"><span class="keyword">function</span>(<span class="params">layerView</span>)</span>&#123;</span><br><span class="line">            layerView.queryFeatures(query).then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>)</span>&#123;</span><br><span class="line">                    <span class="keyword">var</span> graphic = response.features.filter(<span class="function"><span class="keyword">function</span>(<span class="params">hgraphic</span>)</span>&#123;</span><br><span class="line">                            <span class="keyword">var</span> i=<span class="number">0</span>;</span><br><span class="line">                            <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;transIds.length;++i)&#123;</span><br><span class="line">                                    <span class="keyword">if</span>(hgraphic.attributes.INNER_TRAN==transIds[i])&#123;</span><br><span class="line">                                            <span class="keyword">return</span> hgraphic.attributes.INNER_TRAN==transIds[i];</span><br><span class="line">                                    &#125;</span><br><span class="line">                                    <span class="keyword">else</span>&#123;</span><br><span class="line">                                            <span class="keyword">continue</span>;</span><br><span class="line">                                    &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    <span class="keyword">if</span>(<span class="keyword">this</span>.highlight)&#123;</span><br><span class="line">                        <span class="keyword">this</span>.highlight.remove();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">this</span>.highlight=layerView.highlight(graphic);</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></featureset></number></object></p><p>以上代码是查询并高亮展示要素的核心代码。</p><ul><li>问题3 关于非公开链接的登录问题  </li></ul><p>&nbsp;&nbsp;&nbsp;&nbsp;老实说关于这个问题我是很不愿意去说的，因为<font color="#ff0000"><strong>不安全</strong></font>但是有了这个需求，所以不得不去实现，但是我还是要强调，既然是是公开资源就干脆公开，如果需要设计权限那么直接设置就好了或者能不能通过OAuth2进行控制，这个也在研究，但是最简单的方式就是目前这个方式，通过identityManager来实现，具体的方式为：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>([</span><br><span class="line">      <span class="string">"esri/Map"</span>,</span><br><span class="line">      <span class="string">"esri/views/MapView"</span>,</span><br><span class="line">  <span class="string">"esri/layers/FeatureLayer"</span>,</span><br><span class="line">  <span class="string">"esri/identity/ServerInfo"</span>,</span><br><span class="line">  <span class="string">"esri/identity/IdentityManager"</span></span><br><span class="line">    ], <span class="function"><span class="keyword">function</span>(<span class="params">Map, MapView,FeatureLayer,ServerInfo,esriId</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>(&#123;</span><br><span class="line">        basemap: <span class="string">"streets"</span></span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> view = <span class="keyword">new</span> MapView(&#123;</span><br><span class="line">        container: <span class="string">"viewDiv"</span>,</span><br><span class="line">        map: map,</span><br><span class="line">        zoom: <span class="number">4</span>,</span><br><span class="line">        center: [<span class="number">15</span>, <span class="number">65</span>] <span class="comment">// longitude, latitude</span></span><br><span class="line">      &#125;);</span><br><span class="line">  <span class="keyword">var</span> svrInfo = <span class="keyword">new</span> ServerInfo();</span><br><span class="line">  svrInfo.serverString   = <span class="string">"https://sampleserver6.arcgisonline.com/arcgis/rest/services"</span>;</span><br><span class="line">  svrInfo.tokenServiceUrl = <span class="string">"https://sampleserver6.arcgisonline.com/arcgis/tokens/"</span>;</span><br><span class="line">  <span class="keyword">var</span> userInfo = &#123;<span class="attr">username</span>:<span class="string">"user1"</span>,<span class="attr">password</span>:<span class="string">"user1"</span>&#125;;</span><br><span class="line">  </span><br><span class="line">  esriId.generateToken(svrInfo,userInfo).then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line"><span class="keyword">var</span> tokenVal = data.token;</span><br><span class="line"><span class="built_in">console</span>.log(data);</span><br><span class="line">esriId.registerToken(&#123;<span class="attr">server</span>:<span class="string">"https://sampleserver6.arcgisonline.com/arcgis/rest/services"</span>,<span class="attr">token</span>:tokenVal&#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">var</span> secureLayer = <span class="keyword">new</span> FeatureLayer(&#123;</span><br><span class="line">url:<span class="string">"https://sampleserver6.arcgisonline.com/arcgis/rest/services/SaveTheBay/FeatureServer/0"</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">      map.add(secureLayer);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure></p><p>&nbsp;&nbsp;&nbsp;&nbsp;上面代码是一个官网的例子我改造的结果，通过generateToken生成token然后将token注册到我们需要访问的服务器路径，这样在访问的时候就会带上token，实际上是一个很简单的过程，主要是这几个路径的设置。</p><ul><li>问题4 炫酷的三维界面展示 </li></ul><p>&nbsp;&nbsp;&nbsp;&nbsp;这个问题很抽象，什么样的界面才能被称为酷炫？这个是业主提出来的一个需求，主要是看到了一些示例代码，然后看到一些特别酷炫的效果的时候就希望我们也能够做出酷炫的效果，实际上一开始我也不知道具体应该怎么做出酷炫的效果，后来发现实际上酷炫的效果就是一些光流效果，呼吸灯效果以及跑马灯的效果等，这些效果实际上并不算难做，但是结合三维球就不知道应该怎么去做了，不过在研究中我还是领悟了一种方法，利用ArcGIS JS API的MESH来实现，实际上这个mesh是一个几何结构，我理解为网格类似于点线面的一个结构，然后构成了一个三角网，实际上这个功能在示例代码中是用来做虚拟地形模型的，但是根据我的脑洞我觉得可以有更加酷炫的应用，所以针对这个结构进行了一下深入了解。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*  搜索出变压器一定范围内的变压器然后渲染并渲染为三维数据进行展示 </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">RenderTransformers:<span class="function"><span class="keyword">function</span>(<span class="params">layer,pnt,range</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//首先根据点击点的位置搜索一定范围内的变压器数目</span></span><br><span class="line">    <span class="keyword">const</span> exaggeration = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">var</span> points=[];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> index1=<span class="number">0</span>;index1&lt;<span class="number">50</span>;++index1)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> index2 = <span class="number">0</span> ;index2&lt;<span class="number">50</span>;++index2)&#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                points.push([pnt.x<span class="number">-750</span>+<span class="number">30</span>*index1,pnt.y<span class="number">-750</span>+<span class="number">30</span>*index2]);</span><br><span class="line">            &#125;<span class="keyword">catch</span>(error)&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(error);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取变压器功率进行插值</span></span><br><span class="line">    <span class="keyword">var</span> query = layer.createQuery();</span><br><span class="line">    query.outFields=[<span class="string">"*"</span>];</span><br><span class="line">    <span class="keyword">var</span> extentRange = <span class="keyword">new</span> Extent(&#123;</span><br><span class="line">        xmax:pnt.x+<span class="number">750</span>,</span><br><span class="line">        xmin:pnt.x<span class="number">-750</span>,</span><br><span class="line">        ymax:pnt.y+<span class="number">750</span>,</span><br><span class="line">        ymin:pnt.y+<span class="number">750</span>,</span><br><span class="line">        SpatialReference:SpatialReference.WebMercator</span><br><span class="line">    &#125;); </span><br><span class="line">    query.geometry=extentRange;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> mpnts= <span class="keyword">new</span> MultiPoint(points);</span><br><span class="line">    mpnts.spatialReference=SpatialReference.WebMercator;</span><br><span class="line">    _this=<span class="keyword">this</span>;</span><br><span class="line">    layer.queryFeatures(query).then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> featurePower=result.features.map(<span class="function"><span class="keyword">function</span>(<span class="params">graphic</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(graphic.geometry.type==<span class="string">"point"</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> &#123;<span class="string">"x"</span>:pnCent.x,<span class="string">"y"</span>:pnCent.y,<span class="string">"z"</span>:graphic.attributes[<span class="string">"P_S_AVG_1"</span>]&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">var</span> mesh = <span class="keyword">new</span> Mesh(&#123;<span class="attr">spatialReference</span>:SpatialReference.WebMercator&#125;);</span><br><span class="line">        <span class="keyword">var</span> data=[];</span><br><span class="line"></span><br><span class="line">        <span class="comment">//强行写一个插值函数出来</span></span><br><span class="line">        <span class="comment">//<span class="doctag">TODO:</span></span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> mpnts= <span class="keyword">new</span> MultiPoint(points);</span><br><span class="line">    mpnts.spatialReference=SpatialReference.WebMercator;</span><br><span class="line">    _this=<span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        layer.queryElevation(mpnts).then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> mesh = <span class="keyword">new</span> Mesh(&#123;<span class="attr">spatialReference</span>:SpatialReference.WebMercator&#125;);</span><br><span class="line">            <span class="keyword">var</span> data=[];</span><br><span class="line">            <span class="keyword">var</span> tPnts=result.geometry.points;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;<span class="number">50</span>;++i)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">let</span> j=<span class="number">0</span>;j&lt;<span class="number">50</span>;++j)&#123;</span><br><span class="line">                    tPnts[i*<span class="number">50</span>+j][<span class="number">2</span>]=tPnts[i*<span class="number">50</span>+j][<span class="number">2</span>]+<span class="number">200</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;<span class="number">50</span><span class="number">-1</span>;i++)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">let</span> j = <span class="number">0</span> ;j&lt;<span class="number">50</span><span class="number">-1</span>;j++)&#123;</span><br><span class="line">                    data.push(tPnts[i*<span class="number">50</span>+j][<span class="number">0</span>]);data.push(tPnts[i*<span class="number">50</span>+j][<span class="number">1</span>]);data.push(tPnts[i*<span class="number">50</span>+j][<span class="number">2</span>]);</span><br><span class="line">                    data.push(tPnts[(i+<span class="number">1</span>)*<span class="number">50</span>+j][<span class="number">0</span>]);data.push(tPnts[(i+<span class="number">1</span>)*<span class="number">50</span>+j][<span class="number">1</span>]);data.push(tPnts[(i+<span class="number">1</span>)*<span class="number">50</span>+j][<span class="number">2</span>]);</span><br><span class="line">                    data.push(tPnts[i*<span class="number">50</span>+(j+<span class="number">1</span>)][<span class="number">0</span>]);data.push(tPnts[i*<span class="number">50</span>+(j+<span class="number">1</span>)][<span class="number">1</span>]);data.push(tPnts[i*<span class="number">50</span>+(j+<span class="number">1</span>)][<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">                    data.push(tPnts[(i+<span class="number">1</span>)*<span class="number">50</span>+(j+<span class="number">1</span>)][<span class="number">0</span>]);data.push(tPnts[(i+<span class="number">1</span>)*<span class="number">50</span>+(j+<span class="number">1</span>)][<span class="number">1</span>]);data.push(tPnts[(i+<span class="number">1</span>)*<span class="number">50</span>+(j+<span class="number">1</span>)][<span class="number">2</span>]);</span><br><span class="line">                    data.push(tPnts[(i+<span class="number">1</span>)*<span class="number">50</span>+j][<span class="number">0</span>]);data.push(tPnts[(i+<span class="number">1</span>)*<span class="number">50</span>+j][<span class="number">1</span>]);data.push(tPnts[(i+<span class="number">1</span>)*<span class="number">50</span>+j][<span class="number">2</span>]);</span><br><span class="line">                    data.push(tPnts[i*<span class="number">50</span>+(j+<span class="number">1</span>)][<span class="number">0</span>]);data.push(tPnts[i*<span class="number">50</span>+(j+<span class="number">1</span>)][<span class="number">1</span>]);data.push(tPnts[i*<span class="number">50</span>+(j+<span class="number">1</span>)][<span class="number">2</span>]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            mesh.vertexAttributes.position=data;</span><br><span class="line">            <span class="keyword">var</span> component=<span class="keyword">new</span> MeshComponent(&#123;</span><br><span class="line">                material:&#123;</span><br><span class="line">                    color:_this.RenderPowerColor(mesh)</span><br><span class="line">                &#125;,</span><br><span class="line">                shading:<span class="string">"flat"</span></span><br><span class="line">            &#125;)</span><br><span class="line">            mesh.components=[component];</span><br><span class="line">            <span class="keyword">if</span>(_this.IsOrNot)&#123;</span><br><span class="line">                <span class="keyword">var</span> graphic = <span class="keyword">new</span> Graphic(&#123;</span><br><span class="line">                    geometry:mesh,</span><br><span class="line">                    symbol:&#123;</span><br><span class="line">                        type:<span class="string">"mesh-3d"</span>,</span><br><span class="line">                        symbolLayers:[&#123;</span><br><span class="line">                            type:<span class="string">"fill"</span>,</span><br><span class="line">                        &#125;],</span><br><span class="line">                    &#125;,</span><br><span class="line"></span><br><span class="line">                    attributes:&#123;<span class="string">"name"</span>:<span class="string">"graphic1"</span>&#125;,</span><br><span class="line"></span><br><span class="line">                &#125;);</span><br><span class="line">                _this.coolTransGraphicLayer.add(graphic);</span><br><span class="line">                _this.coolTransGraphicLayer.removeMany(_this.coolTransGraphicLayer.graphics.map(<span class="function"><span class="keyword">function</span>(<span class="params">graphic</span>)</span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> graphic.attributes[<span class="string">'name'</span>]==<span class="string">'graphic2'</span>?graphic:<span class="literal">null</span>;</span><br><span class="line">                &#125;));</span><br><span class="line">                _this.IsOrNot=<span class="literal">false</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">var</span> graphic = <span class="keyword">new</span> Graphic(&#123;</span><br><span class="line">                    geometry:mesh,</span><br><span class="line">                    symbol:&#123;</span><br><span class="line">                        type:<span class="string">"mesh-3d"</span>,</span><br><span class="line">                        symbolLayers:[&#123;</span><br><span class="line">                            type:<span class="string">"fill"</span></span><br><span class="line">                        &#125;]</span><br><span class="line">                    &#125;,</span><br><span class="line">                    matreial:&#123;</span><br><span class="line">                        color:[<span class="number">255</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>]</span><br><span class="line">                    &#125;,</span><br><span class="line">                    attributes:&#123;<span class="string">"name"</span>:<span class="string">"graphic2"</span>&#125;,</span><br><span class="line">                &#125;);</span><br><span class="line">                _this.coolTransGraphicLayer.add(graphic);</span><br><span class="line">                _this.coolTransGraphicLayer.removeMany(_this.coolTransGraphicLayer.graphics.map(<span class="function"><span class="keyword">function</span>(<span class="params">graphic</span>)</span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> graphic.attributes[<span class="string">'name'</span>]==<span class="string">'graphic1'</span>?graphic:<span class="literal">null</span>;</span><br><span class="line">                &#125;));</span><br><span class="line">                _this.IsOrNot=<span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(error);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;<span class="keyword">catch</span>(error)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>&nbsp;&nbsp;&nbsp;&nbsp;针对以上代码进行分析，首先构建网格，实际上就是网格点，在以上应用中我是根据输入的点给一个区域范围然后按照一定的比例采样得到一个50*50的格网，通过网格确定了每一个点的经纬度坐标，实际上可以是投影坐标。确定了坐标之后就要渲染了，然后根据要渲染的字段查出要渲染的强度，实际上为了让其显示在地面上我是根据地面的高度加了一个值实际上也可以直接给一个值，这个不重要，这样构造一个mesh的数据，构造数据的时候一定要注意mesh是一个三维网，所以构造的时候一定要三个点构成一个面三个点构成一个面，注意点的顺序不要乱，然后像普通渲染graphic一样渲染这个mesh的结构就可以了。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;专心做了两个月的GIS开发，使用的是ArcGIS的平台，遇到了很多问题，对ArcGIS的API的使用有了更多的体会，另外对于js前端开发也有了更深刻的体会我将就最近做的这个项目集中总结一下在使用ArcGIS API的过程中所遇
      
    
    </summary>
    
      <category term="学习" scheme="http://www.wuweiblog.com/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="ArcGIS开发" scheme="http://www.wuweiblog.com/tags/ArcGIS%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>猝死</title>
    <link href="http://www.wuweiblog.com/2019/01/06/%E7%8C%9D%E6%AD%BB/"/>
    <id>http://www.wuweiblog.com/2019/01/06/猝死/</id>
    <published>2019-01-06T03:38:02.000Z</published>
    <updated>2019-06-25T03:11:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>&nbsp;&nbsp;&nbsp;&nbsp;最近很多新闻都在说年轻人猝死的问题，最近好像胃也不太好，所以也一直关注着这个问题。然后很多资本家的言论在网上发酵，什么996是福报呀之类的言论，然后Github上也发起了抵制996的活动。不得不说现实对于当代年轻人来说真的算不上友好，当然用父母辈的话来说我们似乎是一个最好的时代，但是其实“这是最好的时代，也是最坏的时代”——《双城记》<br>&nbsp;&nbsp;&nbsp;&nbsp;生产力的发展让我们早已远离了父辈所面临的问题，站在父辈的肩膀上的我们生来就不需要考虑如何吃饱，如何穿暖的问题，当生存问题离我们远去的时候在父辈们看来这恐怕就是最好的时代了。但是现实可能与理想存在一些差距，时代的发展永远都会导致一个现象那就是马太效应，虽然人们总是在说纺锤型社会，其实所谓的纺锤型社会只是一种理想状况而已。随着时间的推移，资源会不断的集中于少部分人手中，然后出现金字塔形社会，而且是一个很分明的金字塔，金字塔上下层之间存在着明确的割裂，上层不需要看到下层的情况，下层也无法理解和想象上层的生活。如果一直都是这样倒也罢了，在几千年的社会中一直都是这样，其实我们都知道“已有之事，后必再有，已行之事，后必再行，日光之下并无新事”——《圣经.传道书 v1:9》<br>&nbsp;&nbsp;&nbsp;&nbsp;可是我们国家近二三十年来发展太快，社会主义市场经济形同乱世，既然是乱世那么总是容易产生那么一些人，他们凭借着各种方式或手段实现了从金字塔底层到金字塔上层的跃迁，乱世总是容易让人产生错觉，让人觉得自己也是天选之子。如果经济的发展一如从前，或许我们也不会觉得有什么不一样，但是如同前二三十年那样的发展是不可持续的，是社会生活的非常态，社会的发展总是要回到常态，而由非常态转换到常态的这个过程就是一个割裂的过程，社会顶层与下层割裂的过程。由于资源的集中，处于社会顶层的群里往往掌握着较大的话语权，于是“你不行是因为你不努力！”，“只要努力就能实现阶层跃迁！”这样的言论甚嚣尘上。实际上资本的原始积累是血腥而且残酷的，不是流血便是流泪。我们当然无法否认努力的意义，但是实际上阶层的割裂便是要让我们的努力变得不那么重要。而我们正好处于这个割裂的时代，这个时代的割裂一直拉扯着我们。<br>&nbsp;&nbsp;&nbsp;&nbsp;对于我们来说也许只有两种选择，待在原地一定会被拉扯得粉碎，所以只能拼命工作以求得能够获取阶层的提升而不被彻底的隔离，上升的通道越来越窄，由此导致的社会内卷是明显可见的，而那些猝死的年轻人用他们的死来表现出他们的抗争，也许确实有些事情比死生更重要吧，可是如果死亡只是为这个时代陪葬，那可能我更愿意就这样浑浑噩噩的活着算了。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;最近很多新闻都在说年轻人猝死的问题，最近好像胃也不太好，所以也一直关注着这个问题。然后很多资本家的言论在网上发酵，什么996是福报呀之类的言论，然后Github上也发起了抵制996的活动。不得不说现实对于当代年轻人来说真的算不
      
    
    </summary>
    
    
      <category term="随感" scheme="http://www.wuweiblog.com/tags/%E9%9A%8F%E6%84%9F/"/>
    
  </entry>
  
  <entry>
    <title>我有两盏灯</title>
    <link href="http://www.wuweiblog.com/2018/12/31/%E6%88%91%E6%9C%89%E4%B8%A4%E7%9B%8F%E7%81%AF/"/>
    <id>http://www.wuweiblog.com/2018/12/31/我有两盏灯/</id>
    <published>2018-12-31T15:28:53.000Z</published>
    <updated>2018-12-31T16:58:12.000Z</updated>
    
    <content type="html"><![CDATA[<p>&nbsp;&nbsp;&nbsp;&nbsp;马上就是自然年的2019年了，每年都会给自己做一个总结，或者实在农历新年或者是在自然年，当然今年也不能例外。想要总结的有很多，酒喝的刚刚好，有点微醺不太适合去写代码，最适合写点东西或者是做总结了。今天回来的时候打开了常开的那盏灯，然后思考了很久关上了，打开了了另一盏。所以才有了这个总结的题目，回家的时候刷知乎看到一个问题“哪些观念是越早建立越好的”其中有一个回答是“人总是要面临死亡的”，这个回答对我来说很重要，其实很早就面对过死亡，不过只是以一个旁观者的身份。高中的时候有个同学的父亲因为白血病去世了，那个同学是我一直以来的好朋友，朋友父亲的离世自然是很悲伤，不过那种悲伤可能更多的是同情，是以一种旁观者的姿态去感受所以并没有这么深刻。第二次是本科毕业小妹去世，小妹是我高中同学，在她去世的前几个月我们还一起吃了顿饭，真的想不到就这样离开了我们，这个世界的繁华我想怎么都还没有看够吧，就这么离开这个世界多少有些遗憾吧~小妹的离去让我感受到了生命的脆弱和遗憾；第三次是我大姑的去世，亲人的离世总是会有更多的感慨，看到小姑在葬礼上哭的撕心裂肺，看到爸爸和伯伯红肿的眼睛，还有两个表哥强撑着疲惫的身躯招呼客人，其实不管我们多么的平凡，总是会有人因为我们而欢喜悲伤的吧。<br>&nbsp;&nbsp;&nbsp;&nbsp;所经历的死亡也就这三次了。一次比一次近，所以有时候也会想其实明天和死亡的谁也不知道哪个先到来，所以死亡算是我生命历程中的一盏明灯了，随着我生命的继续它会越来越亮，直到生命的终点。作为一个有限的人，其实死亡一直在我们头顶。其实想想死亡也算是一件好事，千百千年的古人就知道生也有涯，不要以有涯而随无涯。所以我们有限的生命应该做些什么呢？或者又是什么都不做？哲学是个好东西，看起来那些对于永恒对于生命的思考没有什么意义，但是在需要的时候这些对人或者世界最本质的探索就成为了我们不可动摇的磐石，从芝诺到伊比鸠鲁，在死亡的约束下我们有了很多思考，不管怎么说，死亡总是指引着我们向未来探索，或者说不过一死而已未来又有什么可恐惧的呢！<br>&nbsp;&nbsp;&nbsp;&nbsp;另外一盏灯对我来说应该是理想了，很多人会忽略这个东西，但是我不会，死亡是现实如果只是考虑死亡那么我们很快就会得出伊比鸠鲁学派的结论，这样我们就很难理解那些为了全人类而努力奋斗直到牺牲的人了。所以一定有什么东西是能够与死亡抗衡的，它的存在不会随着个人的死亡而消失，这个就是理想了吧。其实在这里说起来显得有些空谈，但是我确实认为这个是一个很重要的东西，面对死亡名利财富，一切的一切都会消失，那么我们终其一生不管有意或者无意都在寻找一些能够与死亡抗衡的东西，对于生物来说最简单也是最直接的那就是基因，所以动物会争夺配偶，为了让基因摆脱死亡的限制传递下去。而我们人类作为自认为高级一些的生物体，基因的延续已经不是我们对抗死亡的唯一方式二零，我们还有一些更高级的方式，那就是理想。其实说起来很虚无缥缈，但是实际上很有必要，我终其一生是想要做些什么？这个就是理想，我所作的对于整个人社会或者人类有意义，或者能够被认可，然后虽然我倒在了通往理想的路上，但是毕竟开辟了一条通往理想的道路，然后更多的人会沿着这条路往前走。以前读鲁迅，知道了有些人想把名字刻在碑上试图不朽，有的人却化作了青青野草。实际上不管是刻在石碑上还是化作野草，他们的目的有一点是相同的，那就是去死亡的对抗。我们必须找一些事物来对抗死亡，然后我们才能超脱死亡。<br>&nbsp;&nbsp;&nbsp;&nbsp;跨年了，死亡的灯又亮了几分，而我理想的灯还是暗淡无光，时间已经不多了，而我必须尽快点亮那生命中的第二盏灯以免在恐惧中失去了自我。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;马上就是自然年的2019年了，每年都会给自己做一个总结，或者实在农历新年或者是在自然年，当然今年也不能例外。想要总结的有很多，酒喝的刚刚好，有点微醺不太适合去写代码，最适合写点东西或者是做总结了。今天回来的时候打开了常开的那盏
      
    
    </summary>
    
      <category term="随感" scheme="http://www.wuweiblog.com/categories/%E9%9A%8F%E6%84%9F/"/>
    
    
      <category term="随感" scheme="http://www.wuweiblog.com/tags/%E9%9A%8F%E6%84%9F/"/>
    
  </entry>
  
  <entry>
    <title>concul服务注册与发现</title>
    <link href="http://www.wuweiblog.com/2018/12/31/concul%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/"/>
    <id>http://www.wuweiblog.com/2018/12/31/concul服务注册与发现/</id>
    <published>2018-12-31T08:34:08.000Z</published>
    <updated>2018-12-31T08:36:46.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="关于服务注册于发现Consul"><a href="#关于服务注册于发现Consul" class="headerlink" title="关于服务注册于发现Consul"></a>关于服务注册于发现Consul</h2><h3 id="微服务"><a href="#微服务" class="headerlink" title="微服务"></a>微服务</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;对于微服务的应用来说由于客户端以及服务端应用接口特别多而且复杂，对于各个客户端之间的通信是一件很复杂得事情，通常情况下一个客户端出现了问题而停止或者更换了端口或者部署机器的地址都会导致其他与之相关联的服务都需要切换端口和IP，这会带来特别大的影响，为了降低服务部署和修改带来的影响于是产生了服务注册于发现的机制。不管什么架构设计，脱离了需求来谈架构就是空谈，但是对于一个公司有着许多不同的业务板块，每个板块之间基本独立但是又有区分，因此使用微服务的架构就是很有必要的了（避免单个服务做得过大导致一旦出现问题整个系统崩溃），提到服务注册和服务发现就不得不提一下微服务的构架，如果采用单体服务的模式，整个系统前后端统一，单体化部署使用服务注册于服务发现的框架反而增加了程序负担这样就得不偿失了：<br>微服务这个概念实际上相对来说比较新，从2012年提出到现在也才经过6年的时间，实际上从微服务被普遍认可和接收也就从2015年开始，我前几天读完了一本关于微服务架构的书也对微服务有了些了解，实际上整个微服务就是我们程序设计中的高内聚低耦合的集中体现。谈到微服务就不能不提SOA，这两种架构之间有着千丝万缕的联系，我实际上也没有真正执行过SOA架构或者微服务架构的应用（以后会执行的~)我只能谈谈我的理解了，对于一个应用来说，采用SOA架构主要过程是首先对业务整体情况进行了解，然后将整体业务拆分为独立的业务逻辑，然后对每一块业务逻辑流程进行分别开发，最后进行集成；而采用微服务的架构可能拆分得更加细粒度，举一个例子如图：  </p><center><img src="https://blogimage-1251632003.cos.ap-guangzhou.myqcloud.com/%E5%BE%AE%E6%9C%8D%E5%8A%A1vsSOA.jpeg"></center>    <p>图片来自<a href="https://blog.csdn.net/u011389515/article/details/80546084" target="_blank" rel="noopener">CSDN博客</a>侵删联系（<a href="mailto:wuwei_cug@163.com" target="_blank" rel="noopener">wuwei_cug@163.com</a>）上面一张图很清晰的说明了SOA与微服务之间的差别，SOA以业务逻辑为粒度构建应用，而微服务架构构建更加细的粒度的独立应用，然后将应用组合起来形成业务逻辑。简单的来说就是对于服务的理解有差异，当然实际上SOA还有EBS企业总线，数据总线等概念，在这里就不详细的描述了。  </p><h3 id="Consul原理"><a href="#Consul原理" class="headerlink" title="Consul原理"></a>Consul原理</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;从上图中可以看到对于一件简单的应用微服务会将其拆分为很多服务然后提供接口，那么实际上这么多服务的管理自然而然就成为了一个需要考虑的问题，实际上对于这个问题SOA也出现过，而SOA采用一个很复杂的逻辑EBS总线去管理所有服务间的通信与调度以及服务的健康检查，实际上微服务并不需要这么一个复杂得逻辑，因为微服务本身的接口很清晰应用服务之间逻辑界限很明确，因此不需要一个过于复杂得调度总线，但是也需要一个服务注册于服务发现的管理，这个就是我们要着重介绍的Consul，在这里我只介绍Consul的使用以及服务的注册，更多的内容还在摸索当中：<br>&nbsp;&nbsp;&nbsp;&nbsp;Consul的架构如图：  </p><center><img src="https://blogimage-1251632003.cos.ap-guangzhou.myqcloud.com/consul%E7%BB%93%E6%9E%84.png"></center>  <p>上面这张图示从<a href="https://www.consul.io/docs/internals/architecture.html" target="_blank" rel="noopener">官网</a>下载下来的图，随之还有官网的描述，英文好的同学可以直接看原文，我会在每一个描述上添加上自己的理解。  </p><ul><li><p>Let’s break down this image and describe each piece. First of all, we can see that there are two datacenters, labeled “one” and “two”. Consul has first class support for multiple datacenters and expects this to be the common case.<br>这里提到了一个特性，多数据中心支持，数据中心实际上只是一个局域网络比如我们的内网，私有云等，一般数据中心之间的数据是不进行交互的实际上不太能明白多数据中心支持的意义在哪里，是不是为了内外网部署应用的时候能够有一个统一的管理？</p></li><li><p>Within each datacenter, we have a mixture of clients and servers. It is expected that there be between three to five servers. This strikes a balance between availability in the case of failure and performance, as consensus gets progressively slower as more machines are added. However, there is no limit to the number of clients, and they can easily scale into the thousands or tens of thousands.<br>上面谈到了关于数据中心，我们暂时不去管数据中心，我们看每一个数据中心中的部署，对于每一个数据中心其构成为分部式部署架构，主要分为client模式和server模式上面这段说明了server模式和client模式的数量，对于这两种模式其实官网也有一个解释：<br><strong>Client</strong> - A client is an agent that forwards all RPCs to a server. The client is relatively stateless. The only background activity a client performs is taking part in the LAN gossip pool. This has a minimal resource overhead and consumes only a small amount of network bandwidth.<br><strong>Server</strong> - A server is an agent with an expanded set of responsibilities including participating in the Raft quorum, maintaining cluster state, responding to RPC queries, exchanging WAN gossip with other datacenters, and forwarding queries to leaders or remote datacenters<br>官网的解释很抽象，我不太想去翻译，翻译出来没有太大的意义，我在这里谈谈我自己的理解，实际上整个服务注册说明所有注册的服务都有一个统一的维护那就是所说的LAN gossip pool，在这个数据池中存储了所有的注册服务，而客户端的作用就是有一个服务注册进来了，那么就将这个服务添加到LAN gossip pool中，另外客户端的作用就是转发查询请求给服务端。客户端的功能比较简单，相对复杂的是服务端，服务端包含客户端的功能此外还需要进行健康检查和响应查询，服务端包含leader和follower，理论上每个服务端都对注册的服务进行健康检查，然后发送给leader，通过投票机制来确定注册的服务的健康状况，因此官方推荐的服务端为3个或5个，必须为奇数个，且不宜太多增加check的花销。</p></li></ul><ul><li><p>All the nodes that are in a datacenter participate in a gossip protocol. This means there is a gossip pool that contains all the nodes for a given datacenter. This serves a few purposes: first, there is no need to configure clients with the addresses of servers; discovery is done automatically. Second, the work of detecting node failures is not placed on the servers but is distributed. This makes failure detection much more scalable than naive heartbeating schemes. Thirdly, it is used as a messaging layer to notify when important events such as leader election take place.<br>上面这一段话中唯一要注意的就是那个thrid，其他亮点在上一个客户端和服务端的解析中已经说明了，因此着重讲讲我对第三点的理解，实际上选举出leader是一个很重要的部分，consul是通过Raft协议选举出leader，具体的方法我查找了很多地方在<a href="https://stackoverflow.com/questions/27724519/how-does-a-consul-agent-know-it-is-the-leader-of-a-cluster" target="_blank" rel="noopener">stackoverflow</a>上略有提及，是通过一个叫randomized timers的方法选取的，具体的方法需要参看<a href="https://ramcloud.stanford.edu/wiki/download/attachments/11370504/raft.pdf" target="_blank" rel="noopener">论文</a>如果我有时间看论文的话在具体说说这个方法吧。现在没有时间看所以暂且放一放</p></li><li><p>The servers in each datacenter are all part of a single Raft peer set. This means that they work together to elect a single leader, a selected server which has extra duties. The leader is responsible for processing all queries and transactions. Transactions must also be replicated to all peers as part of the consensus protocol. Because of this requirement, when a non-leader server receives an RPC request, it forwards it to the cluster leader.<br>这里承接上面一段说了一些关于服务节点同步以及leader事务同步的问题，这个深入讨论就涉及代码层了，等我有时间阅读代码之后再讨论。</p></li></ul><ul><li>The server nodes also operate as part of a WAN gossip pool. This pool is different from the LAN pool as it is optimized for the higher latency of the internet and is expected to contain only other Consul server nodes. The purpose of this pool is to allow datacenters to discover each other in a low-touch manner. Bringing a new datacenter online is as easy as joining the existing WAN gossip pool. Because the servers are all operating in this pool, it also enables cross-datacenter requests. When a server receives a request for a different datacenter, it forwards it to a random server in the correct datacenter. That server may then forward to the local leader.  </li><li>This results in a very low coupling between datacenters, but because of failure detection, connection caching and multiplexing, cross-datacenter requests are relatively fast and reliable.</li><li><p>In general, data is not replicated between different Consul datacenters. When a request is made for a resource in another datacenter, the local Consul servers forward an RPC request to the remote Consul servers for that resource and return the results. If the remote datacenter is not available, then those resources will also not be available, but that won’t otherwise affect the local datacenter. There are some special situations where a limited subset of data can be replicated, such as with Consul’s built-in ACL replication capability, or external tools like consul-replicate.<br>上面提到的关于多数据中心的作用以及使用的集中体现，实际上我认为没有太大的必要做多中心，本省数据中心之间也不会互相访问，不知道多数据中心的管理意义在哪里，想来不过也就是增加了数据中心的扩展性，但是实际应用中不会多中心部署吧，与其这样还不如每个私有云部署一个来的方便，不过如果多中心之间有通信的话可能还是有些作用的，这个可能需要应用场景的支撑了，现在我还想不出有什么意义。</p></li><li><p>In some places, client agents may cache data from the servers to make it available locally for performance and reliability. Examples include Connect certificates and intentions which allow the client agent to make local decisions about inbound connection requests without a round trip to the servers. Some API endpoints also support optional result caching. This helps reliability because the local agent can continue to respond to some queries like service-discovery or Connect authorization from cache even if the connection to the servers is disrupted or the servers are temporarily unavailable.<br>上面这段提到了一种客户端缓存数据的特殊情况，主要是为了提高可靠性，通过客户端缓存某些数据以免在客户端与服务端通信不畅或服务端暂时挂起的状态下还能够保持响应的可用性。</p></li></ul><p>&nbsp;&nbsp;&nbsp;&nbsp;上面讲了一大段对于架构的介绍以及高可用性的部署，客户端服务端的分工以及各种协议的通信实际上就是为了解决服务注册和发现的问题，看似一个很小的问题却考虑了一个这么庞大的架构来处理就存在一个有没有必要的问题，对于少量服务的应用需求实际上光是理解这个consul就是一个很高的成本，采用服务注册于发现的机制完全是没有必要的，但是对于企业级的应用来说却是很有必要的，其必要性主要体现在：1.服务运维，从运维的角度来说服务的动态变化实际上极大的增加的运维测试的负担，必须要对服务有一个集中管理的过程；2.从可扩展性的角度来说，通过此种方式在分布式架构下大大提高了服务的可扩展性，甚至可以说是随意扩展；3.从开发的角度来说通过服务发现统一了接口，避免由于部署的差异导致接口的变化，当然这个实际上也可以理解为运维测试的好处。</p><h3 id="consul使用"><a href="#consul使用" class="headerlink" title="consul使用"></a>consul使用</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;提了一大堆的介绍，从开发的角度说一下Consul的使用，因为死单机所以我采用的是单机Docker部署的方式，安装环境为Windows10 开发语言为python3.6.x。首先运行consul:<a href="https://livewyer.io/blog/2015/02/05/service-discovery-docker-containers-using-consul-and-registrator/" target="_blank" rel="noopener">参考网上教程</a>运行了一个单节点的consul，这个是最简单的运行，多节点就是添加节点，这个以后再说。运行完成之后在浏览器可以看到如下页面：  </p><p><center><img src="https://blogimage-1251632003.cos.ap-guangzhou.myqcloud.com/consul-ui.jpg"></center><br>&nbsp;&nbsp;&nbsp;&nbsp;从上面的界面上可以看到服务运行的状态信息，有一个consul 的节点，另外运行了一个datastorage的服务，不过这个服务failling，是一个失败的服务，因为我停掉了服务器。我们可以根据上面的参考教材通过命令去注册服务，当然我这里使用python-consul直接在服务启动的时候进行注册，具体的代码为:  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> mongoRoute <span class="keyword">as</span> MongoRoute</span><br><span class="line"><span class="keyword">import</span> instance</span><br><span class="line"><span class="keyword">import</span> consul</span><br><span class="line"></span><br><span class="line">api = instance.api</span><br><span class="line">app = instance.app</span><br><span class="line">conf= instance.conf</span><br><span class="line"><span class="comment">#help info </span></span><br><span class="line"><span class="meta">@app.route('/filestorage/v1.0.0/help') </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">help</span><span class="params">()</span>:</span> </span><br><span class="line">   <span class="keyword">return</span> <span class="string">'help info'</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#for health check</span></span><br><span class="line"><span class="meta">@app.route('/filestorage/v1.0.0/check', methods=['GET'])  </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span><span class="params">()</span>:</span></span><br><span class="line">   <span class="keyword">return</span> <span class="string">'success'</span></span><br><span class="line"></span><br><span class="line">api.add_resource(MongoRoute.LargeFileUploadChunkMongo,   <span class="string">'/filestorage/v1.0.0.0/mongodb/uploadlargechunk'</span>)</span><br><span class="line">api.add_resource(MongoRoute.LargeFileUploadFinishedMongo,<span class="string">'/filestorage/v1.0.0.0/mongodb/uploadlargefinished'</span>)</span><br><span class="line">api.add_resource(MongoRoute.SmallFileUploadMongo,        <span class="string">'/filestorage/v1.0.0.0/mongodb/uploadsmall'</span>)</span><br><span class="line"></span><br><span class="line">api.add_resource(MongoRoute.LargeFileDownloadMongo,      <span class="string">'/filestorage/v1.0.0.0/mongo/downloadlarge'</span>)</span><br><span class="line">api.add_resource(MongoRoute.SmallFileDownloadMongo,      <span class="string">'/filestorage/v1.0.0.0/mongo/downloadsmall'</span>)</span><br><span class="line">api.add_resource(MongoRoute.SmallFileDownloadAsFileMongo,<span class="string">'/filestorage/v1.0.0.0/mongo/downloadsmallasfile'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#services register</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">consul_service_register</span><span class="params">()</span>:</span></span><br><span class="line">   client = consul.Consul()</span><br><span class="line">   service_id = <span class="string">"datastorage-localhost:8081"</span></span><br><span class="line">   httpcheck  = <span class="string">"http://192.168.1.25:8081/filestorage/v1.0.0/check"</span></span><br><span class="line">   check = consul.Check.http(httpcheck, <span class="string">"30s"</span>)</span><br><span class="line">   client.agent.service.register(name=<span class="string">"datastorage"</span>,service_id=service_id,address=<span class="string">'192.168.1.25'</span>,</span><br><span class="line">                  port=<span class="number">8081</span>,tags=[<span class="string">'filestorage'</span>],check=check)</span><br><span class="line"></span><br><span class="line"><span class="comment">#services unregister</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">consul_service_unregister</span><span class="params">()</span>:</span></span><br><span class="line">   client = consul.Consul()</span><br><span class="line">   service_id = <span class="string">"datastorage-localhost:8081"</span></span><br><span class="line">   client.agent.service.deregister(name=<span class="string">"datastorage"</span>,service_id=service_id)</span><br><span class="line"></span><br><span class="line"><span class="comment"># start instance </span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>: </span><br><span class="line">   <span class="keyword">try</span>:</span><br><span class="line">      consul_service_register()</span><br><span class="line">      app.run(host=<span class="string">'0.0.0.0'</span>,port=<span class="number">8081</span>)</span><br><span class="line">   <span class="keyword">except</span> RuntimeError <span class="keyword">as</span> msg:</span><br><span class="line">      <span class="keyword">if</span> str(msg) == <span class="string">"Server going down"</span>:</span><br><span class="line">         consul_service_unregister();</span><br><span class="line">         print(msg)</span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">         print(<span class="string">"server stopped by accident!"</span>)</span><br></pre></td></tr></table></figure><p>以上的项目具体代码参看<a href="https://github.com/RemoteSensingFrank/micro_server" target="_blank" rel="noopener">我的Github</a>实际上就是给出注册的服务的id，服务名，然后给一个check的地址，然后consul的server会查询这个check的地址确认服务是否可用，在上面我用的是IP地址，因为服务搭建在docker中，如果用localhost是无法访问到的因此注册的时候要用绝对地址。<br>&nbsp;&nbsp;&nbsp;&nbsp;以上代码简单的介绍了一下服务注册，由于这个代码只是提供接口，并不需要接额外的服务，因此并不需要使用服务发现模块，具体使用服务发现模块也很简单就是通过服务名或服务id查询可用的host以及port然后请求就好了，如果查询不到则说明服务不可用。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;关于服务注册于发现Consul&quot;&gt;&lt;a href=&quot;#关于服务注册于发现Consul&quot; class=&quot;headerlink&quot; title=&quot;关于服务注册于发现Consul&quot;&gt;&lt;/a&gt;关于服务注册于发现Consul&lt;/h2&gt;&lt;h3 id=&quot;微服务&quot;&gt;&lt;a href=
      
    
    </summary>
    
      <category term="学习" scheme="http://www.wuweiblog.com/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="系统架构 学习" scheme="http://www.wuweiblog.com/tags/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84-%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
</feed>
